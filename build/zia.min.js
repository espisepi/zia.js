var Zia={};Zia.Quaternion=function(a,b,c,d){this._x=a||0,this._y=b||0,this._z=c||0,this._w=void 0!==d?d:1},Zia.Quaternion.prototype={constructor:Zia.Quaternion,get x(){return this._x},set x(a){this._x=a,this._onChangeCallback()},get y(){return this._y},set y(a){this._y=a,this._onChangeCallback()},get z(){return this._z},set z(a){this._z=a,this._onChangeCallback()},get w(){return this._w},set w(a){this._w=a,this._onChangeCallback()},set:function(a,b,c,d){return this._x=a,this._y=b,this._z=c,this._w=d,this._onChangeCallback(),this},copy:function(a){return this._x=a._x,this._y=a._y,this._z=a._z,this._w=a._w,this._onChangeCallback(),this},setFromEuler:function(a,b){var c=Math.cos(a._x/2),d=Math.cos(a._y/2),e=Math.cos(a._z/2),f=Math.sin(a._x/2),g=Math.sin(a._y/2),h=Math.sin(a._z/2);return"XYZ"===a.order?(this._x=f*d*e+c*g*h,this._y=c*g*e-f*d*h,this._z=c*d*h+f*g*e,this._w=c*d*e-f*g*h):"YXZ"===a.order?(this._x=f*d*e+c*g*h,this._y=c*g*e-f*d*h,this._z=c*d*h-f*g*e,this._w=c*d*e+f*g*h):"ZXY"===a.order?(this._x=f*d*e-c*g*h,this._y=c*g*e+f*d*h,this._z=c*d*h+f*g*e,this._w=c*d*e-f*g*h):"ZYX"===a.order?(this._x=f*d*e-c*g*h,this._y=c*g*e+f*d*h,this._z=c*d*h-f*g*e,this._w=c*d*e+f*g*h):"YZX"===a.order?(this._x=f*d*e+c*g*h,this._y=c*g*e+f*d*h,this._z=c*d*h-f*g*e,this._w=c*d*e-f*g*h):"XZY"===a.order&&(this._x=f*d*e-c*g*h,this._y=c*g*e-f*d*h,this._z=c*d*h+f*g*e,this._w=c*d*e+f*g*h),b!==!1&&this._onChangeCallback(),this},setFromAxisAngle:function(a,b){var c=b/2,d=Math.sin(c);return this._x=a.x*d,this._y=a.y*d,this._z=a.z*d,this._w=Math.cos(c),this._onChangeCallback(),this},setFromRotationMatrix:function(a){var b,c=a.elements,d=c[0],e=c[4],f=c[8],g=c[1],h=c[5],i=c[9],j=c[2],k=c[6],l=c[10],m=d+h+l;return m>0?(b=.5/Math.sqrt(m+1),this._w=.25/b,this._x=(k-i)*b,this._y=(f-j)*b,this._z=(g-e)*b):d>h&&d>l?(b=2*Math.sqrt(1+d-h-l),this._w=(k-i)/b,this._x=.25*b,this._y=(e+g)/b,this._z=(f+j)/b):h>l?(b=2*Math.sqrt(1+h-d-l),this._w=(f-j)/b,this._x=(e+g)/b,this._y=.25*b,this._z=(i+k)/b):(b=2*Math.sqrt(1+l-d-h),this._w=(g-e)/b,this._x=(f+j)/b,this._y=(i+k)/b,this._z=.25*b),this._onChangeCallback(),this},setFromUnitVectors:function(){var a,b,c=1e-6;return function(d,e){return void 0===a&&(a=new Zia.Vector3),b=d.dot(e)+1,c>b?(b=0,Math.abs(d.x)>Math.abs(d.z)?a.set(-d.y,d.x,0):a.set(0,-d.z,d.y)):a.crossVectors(d,e),this._x=a.x,this._y=a.y,this._z=a.z,this._w=b,this.normalize(),this}}(),inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var a=this.length();return 0===a?(this._x=0,this._y=0,this._z=0,this._w=1):(a=1/a,this._x=this._x*a,this._y=this._y*a,this._z=this._z*a,this._w=this._w*a),this._onChangeCallback(),this},multiply:function(a){return this.multiplyQuaternions(this,a)},multiplyQuaternions:function(a,b){var c=a._x,d=a._y,e=a._z,f=a._w,g=b._x,h=b._y,i=b._z,j=b._w;return this._x=c*j+f*g+d*i-e*h,this._y=d*j+f*h+e*g-c*i,this._z=e*j+f*i+c*h-d*g,this._w=f*j-c*g-d*h-e*i,this._onChangeCallback(),this},slerp:function(a,b){var c=this._x,d=this._y,e=this._z,f=this._w,g=f*a._w+c*a._x+d*a._y+e*a._z;if(0>g?(this._w=-a._w,this._x=-a._x,this._y=-a._y,this._z=-a._z,g=-g):this.copy(a),g>=1)return this._w=f,this._x=c,this._y=d,this._z=e,this;var h=Math.acos(g),i=Math.sqrt(1-g*g);if(Math.abs(i)<.001)return this._w=.5*(f+this._w),this._x=.5*(c+this._x),this._y=.5*(d+this._y),this._z=.5*(e+this._z),this;var j=Math.sin((1-b)*h)/i,k=Math.sin(b*h)/i;return this._w=f*j+this._w*k,this._x=c*j+this._x*k,this._y=d*j+this._y*k,this._z=e*j+this._z*k,this._onChangeCallback(),this},equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._w===this._w},fromArray:function(a){return this._x=a[0],this._y=a[1],this._z=a[2],this._w=a[3],this._onChangeCallback(),this},toArray:function(){return[this._x,this._y,this._z,this._w]},onChange:function(a){return this._onChangeCallback=a,this},_onChangeCallback:function(){},suppressChangeCallback:function(a){var b=this._onChangeCallback;this._onChangeCallback=function(){},a(),this._onChangeCallback=b},clone:function(){return new Zia.Quaternion(this._x,this._y,this._z,this._w)},toJS:function(){return[this._x,this._y,this._z,this._w]}},Zia.Quaternion.slerp=function(a,b,c,d){return c.copy(a).slerp(b,d)},Zia.Vector3=function(a,b,c){this._x=a||0,this._y=b||0,this._z=c||0},Zia.Vector3.prototype={constructor:Zia.Vector3,get x(){return this._x},set x(a){this._x=a,this._onChangeCallback()},get y(){return this._y},set y(a){this._y=a,this._onChangeCallback()},get z(){return this._z},set z(a){this._z=a,this._onChangeCallback()},set:function(a,b,c){return this._x=a,this._y=b,this._z=c,this._onChangeCallback(),this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;default:throw new Error("index is out of range: "+a)}},getComponent:function(a){switch(a){case 0:return this._x;case 1:return this._y;case 2:return this._z;default:throw new Error("index is out of range: "+a)}},copy:function(a){return this._x=a._x,this._y=a._y,this._z=a._z,this._onChangeCallback(),this},add:function(a){return this._x+=a._x,this._y+=a._y,this._z+=a._z,this._onChangeCallback(),this},addScalar:function(a){return this._x+=a,this._y+=a,this._z+=a,this._onChangeCallback(),this},addVectors:function(a,b){return this._x=a._x+b._x,this._y=a._y+b._y,this._z=a._z+b._z,this._onChangeCallback(),this},sub:function(a){return this._x-=a._x,this._y-=a._y,this._z-=a._z,this._onChangeCallback(),this},subVectors:function(a,b){return this._x=a._x-b._x,this._y=a._y-b._y,this._z=a._z-b._z,this._onChangeCallback(),this},multiply:function(a){return this._x*=a._x,this._y*=a._y,this._z*=a._z,this._onChangeCallback(),this},multiplyScalar:function(a){return this._x*=a,this._y*=a,this._z*=a,this._onChangeCallback(),this},multiplyVectors:function(a,b){return this._x=a._x*b._x,this._y=a._y*b._y,this._z=a._z*b._z,this._onChangeCallback(),this},applyEuler:function(){var a;return function(b){return void 0===a&&(a=new Zia.Quaternion),this.applyQuaternion(a.setFromEuler(b)),this}}(),applyAxisAngle:function(){var a;return function(b,c){return void 0===a&&(a=new Zia.Quaternion),this.applyQuaternion(a.setFromAxisAngle(b,c)),this}}(),applyMatrix3:function(a){var b=this._x,c=this._y,d=this._z,e=a.elements;return this._x=e[0]*b+e[3]*c+e[6]*d,this._y=e[1]*b+e[4]*c+e[7]*d,this._z=e[2]*b+e[5]*c+e[8]*d,this._onChangeCallback(),this},applyMatrix4:function(a){var b=this._x,c=this._y,d=this._z,e=a.elements;return this._x=e[0]*b+e[4]*c+e[8]*d+e[12],this._y=e[1]*b+e[5]*c+e[9]*d+e[13],this._z=e[2]*b+e[6]*c+e[10]*d+e[14],this._onChangeCallback(),this},applyProjection:function(a){var b=this._x,c=this._y,d=this._z,e=a.elements,f=1/(e[3]*b+e[7]*c+e[11]*d+e[15]);return this._x=(e[0]*b+e[4]*c+e[8]*d+e[12])*f,this._y=(e[1]*b+e[5]*c+e[9]*d+e[13])*f,this._z=(e[2]*b+e[6]*c+e[10]*d+e[14])*f,this._onChangeCallback(),this},applyQuaternion:function(a){var b=this._x,c=this._y,d=this._z,e=a._x,f=a._y,g=a._z,h=a._w,i=h*b+f*d-g*c,j=h*c+g*b-e*d,k=h*d+e*c-f*b,l=-e*b-f*c-g*d;return this._x=i*h+l*-e+j*-g-k*-f,this._y=j*h+l*-f+k*-e-i*-g,this._z=k*h+l*-g+i*-f-j*-e,this._onChangeCallback(),this},transformDirection:function(a){var b=this._x,c=this._y,d=this._z,e=a.elements;return this._x=e[0]*b+e[4]*c+e[8]*d,this._y=e[1]*b+e[5]*c+e[9]*d,this._z=e[2]*b+e[6]*c+e[10]*d,this._onChangeCallback(),this.normalize(),this},divide:function(a){return this._x/=a._x,this._y/=a._y,this._z/=a._z,this._onChangeCallback(),this},divideScalar:function(a){if(0!==a){var b=1/a;this._x*=b,this._y*=b,this._z*=b}else this._x=0,this._y=0,this._z=0;return this._onChangeCallback(),this},min:function(a){return this._x>a._x&&(this._x=a._x),this._y>a._y&&(this._y=a._y),this._z>a._z&&(this._z=a._z),this._onChangeCallback(),this},max:function(a){return this._x<a._x&&(this._x=a._x),this._y<a._y&&(this._y=a._y),this._z<a._z&&(this._z=a._z),this._onChangeCallback(),this},clamp:function(a,b){return this._x<a._x?this._x=a._x:this._x>b._x&&(this._x=b._x),this._y<a._y?this._y=a._y:this._y>b._y&&(this._y=b._y),this._z<a._z?this._z=a._z:this._z>b._z&&(this._z=b._z),this._onChangeCallback(),this},clampScalar:function(){var a,b;return function(c,d){return void 0===a&&(a=new Zia.Vector3,b=new Zia.Vector3),a.set(c,c,c),b.set(d,d,d),this.clamp(a,b)}}(),floor:function(){return this._x=Math.floor(this._x),this._y=Math.floor(this._y),this._z=Math.floor(this._z),this._onChangeCallback(),this},ceil:function(){return this._x=Math.ceil(this._x),this._y=Math.ceil(this._y),this._z=Math.ceil(this._z),this._onChangeCallback(),this},round:function(){return this._x=Math.round(this._x),this._y=Math.round(this._y),this._z=Math.round(this._z),this._onChangeCallback(),this},roundToZero:function(){return this._x=this._x<0?Math.ceil(this._x):Math.floor(this._x),this._y=this._y<0?Math.ceil(this._y):Math.floor(this._y),this._z=this._z<0?Math.ceil(this._z):Math.floor(this._z),this._onChangeCallback(),this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this._x*a._x+this._y*a._y+this._z*a._z},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z)},lengthManhattan:function(){return Math.abs(this._x)+Math.abs(this._y)+Math.abs(this._z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){var b=this.length();return 0!==b&&a!==b&&this.multiplyScalar(a/b),this},lerp:function(a,b){return this._x+=(a._x-this._x)*b,this._y+=(a._y-this._y)*b,this._z+=(a._z-this._z)*b,this._onChangeCallback(),this},cross:function(a){var b=this._x,c=this._y,d=this._z;return this._x=c*a._z-d*a._y,this._y=d*a._x-b*a._z,this._z=b*a._y-c*a._x,this._onChangeCallback(),this},crossVectors:function(a,b){var c=a._x,d=a._y,e=a._z,f=b._x,g=b._y,h=b._z;return this._x=d*h-e*g,this._y=e*f-c*h,this._z=c*g-d*f,this._onChangeCallback(),this},projectOnVector:function(){var a,b;return function(c){return void 0===a&&(a=new Zia.Vector3),a.copy(c).normalize(),b=this.dot(a),this.copy(a).multiplyScalar(b)}}(),projectOnPlane:function(){var a;return function(b){return void 0===a&&(a=new Zia.Vector3),a.copy(this).projectOnVector(b),this.sub(a)}}(),reflect:function(){var a;return function(b){return void 0===a&&(a=new Zia.Vector3),this.sub(a.copy(b).multiplyScalar(2*this.dot(b)))}}(),angleTo:function(a){var b=this.dot(a)/(this.length()*a.length());return Math.acos(Zia.Math.clamp(b,-1,1))},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this._x-a._x,c=this._y-a._y,d=this._z-a._z;return b*b+c*c+d*d},setFromMatrixPosition:function(a){return this._x=a.elements[12],this._y=a.elements[13],this._z=a.elements[14],this._onChangeCallback(),this},setFromMatrixScale:function(a){var b=this.set(a.elements[0],a.elements[1],a.elements[2]).length(),c=this.set(a.elements[4],a.elements[5],a.elements[6]).length(),d=this.set(a.elements[8],a.elements[9],a.elements[10]).length();return this._x=b,this._y=c,this._z=d,this._onChangeCallback(),this},setFromMatrixColumn:function(a,b){var c=4*a,d=b.elements;return this._x=d[c],this._y=d[c+1],this._z=d[c+2],this._onChangeCallback(),this},equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z},fromArray:function(a){return this._x=a[0],this._y=a[1],this._z=a[2],this._onChangeCallback(),this},toArray:function(){return[this._x,this._y,this._z]},onChange:function(a){return this._onChangeCallback=a,this},_onChangeCallback:function(){},suppressChangeCallback:function(a){var b=this._onChangeCallback;this._onChangeCallback=function(){},a(),this._onChangeCallback=b},clone:function(){return new Zia.Vector3(this._x,this._y,this._z)},toJS:function(){return[this._x,this._y,this._z]}},Zia.Color4=function(a,b,c,d){this.r=a,this.g=b,this.b=c,this.a=d},Zia.Color4.prototype={copy:function(a){return this.r=a.r,this.g=a.g,this.b=a.b,this.a=a.a,this},multiplyScalar:function(a){return this.r*=a,this.g*=a,this.b*=a,this},toJS:function(){return[this.r,this.g,this.b,this.a]}},Zia.Euler=function(a,b,c,d){this._x=a||0,this._y=b||0,this._z=c||0,this._order=d||Zia.Euler.DefaultOrder},Zia.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],Zia.Euler.DefaultOrder="XYZ",Zia.Euler.prototype={constructor:Zia.Euler,_x:0,_y:0,_z:0,_order:Zia.Euler.DefaultOrder,get x(){return this._x},set x(a){this._x=a,this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a,this.onChangeCallback()},get z(){return this._z},set z(a){this._z=a,this.onChangeCallback()},get order(){return this._order},set order(a){this._order=a,this.onChangeCallback()},set:function(a,b,c,d){return this._x=a,this._y=b,this._z=c,this._order=d||this._order,this.onChangeCallback(),this},copy:function(a){return this._x=a._x,this._y=a._y,this._z=a._z,this._order=a._order,this.onChangeCallback(),this},setFromRotationMatrix:function(a,b){var c=Zia.Math.clamp,d=a.elements,e=d[0],f=d[4],g=d[8],h=d[1],i=d[5],j=d[9],k=d[2],l=d[6],m=d[10];return b=b||this._order,"XYZ"===b?(this._y=Math.asin(c(g,-1,1)),Math.abs(g)<.99999?(this._x=Math.atan2(-j,m),this._z=Math.atan2(-f,e)):(this._x=Math.atan2(l,i),this._z=0)):"YXZ"===b?(this._x=Math.asin(-c(j,-1,1)),Math.abs(j)<.99999?(this._y=Math.atan2(g,m),this._z=Math.atan2(h,i)):(this._y=Math.atan2(-k,e),this._z=0)):"ZXY"===b?(this._x=Math.asin(c(l,-1,1)),Math.abs(l)<.99999?(this._y=Math.atan2(-k,m),this._z=Math.atan2(-f,i)):(this._y=0,this._z=Math.atan2(h,e))):"ZYX"===b?(this._y=Math.asin(-c(k,-1,1)),Math.abs(k)<.99999?(this._x=Math.atan2(l,m),this._z=Math.atan2(h,e)):(this._x=0,this._z=Math.atan2(-f,i))):"YZX"===b?(this._z=Math.asin(c(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(-j,i),this._y=Math.atan2(-k,e)):(this._x=0,this._y=Math.atan2(g,m))):"XZY"===b?(this._z=Math.asin(-c(f,-1,1)),Math.abs(f)<.99999?(this._x=Math.atan2(l,i),this._y=Math.atan2(g,e)):(this._x=Math.atan2(-j,m),this._y=0)):console.warn("Zia.Euler: .setFromRotationMatrix() given unsupported order: "+b),this._order=b,this.onChangeCallback(),this},setFromQuaternion:function(a,b,c){var d=Zia.Math.clamp,e=a.x*a.x,f=a.y*a.y,g=a.z*a.z,h=a.w*a.w;return b=b||this._order,"XYZ"===b?(this._x=Math.atan2(2*(a.x*a.w-a.y*a.z),h-e-f+g),this._y=Math.asin(d(2*(a.x*a.z+a.y*a.w),-1,1)),this._z=Math.atan2(2*(a.z*a.w-a.x*a.y),h+e-f-g)):"YXZ"===b?(this._x=Math.asin(d(2*(a.x*a.w-a.y*a.z),-1,1)),this._y=Math.atan2(2*(a.x*a.z+a.y*a.w),h-e-f+g),this._z=Math.atan2(2*(a.x*a.y+a.z*a.w),h-e+f-g)):"ZXY"===b?(this._x=Math.asin(d(2*(a.x*a.w+a.y*a.z),-1,1)),this._y=Math.atan2(2*(a.y*a.w-a.z*a.x),h-e-f+g),this._z=Math.atan2(2*(a.z*a.w-a.x*a.y),h-e+f-g)):"ZYX"===b?(this._x=Math.atan2(2*(a.x*a.w+a.z*a.y),h-e-f+g),this._y=Math.asin(d(2*(a.y*a.w-a.x*a.z),-1,1)),this._z=Math.atan2(2*(a.x*a.y+a.z*a.w),h+e-f-g)):"YZX"===b?(this._x=Math.atan2(2*(a.x*a.w-a.z*a.y),h-e+f-g),this._y=Math.atan2(2*(a.y*a.w-a.x*a.z),h+e-f-g),this._z=Math.asin(d(2*(a.x*a.y+a.z*a.w),-1,1))):"XZY"===b?(this._x=Math.atan2(2*(a.x*a.w+a.y*a.z),h-e+f-g),this._y=Math.atan2(2*(a.x*a.z+a.y*a.w),h+e-f-g),this._z=Math.asin(d(2*(a.z*a.w-a.x*a.y),-1,1))):console.warn("Zia.Euler: .setFromQuaternion() given unsupported order: "+b),this._order=b,c!==!1&&this.onChangeCallback(),this},reorder:function(){var a=new Zia.Quaternion;return function(b){a.setFromEuler(this),this.setFromQuaternion(a,b)}}(),equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._order===this._order},fromArray:function(a){return this._x=a[0],this._y=a[1],this._z=a[2],void 0!==a[3]&&(this._order=a[3]),this.onChangeCallback(),this},toArray:function(){return[this._x,this._y,this._z,this._order]},onChange:function(a){return this.onChangeCallback=a,this},onChangeCallback:function(){},clone:function(){return new Zia.Euler(this._x,this._y,this._z,this._order)}},Zia.Math={/*!
  Math.uuid.js (v1.4)
  http://www.broofa.com
  mailto:robert@broofa.com

  Copyright (c) 2010 Robert Kieffer
  Dual licensed under the MIT and GPL licenses.
  */
generateUUID:function(){var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");return function(b,c){var d,e=a,f=[];if(c=c||e.length,b)for(d=0;b>d;d++)f[d]=e[0|Math.random()*c];else{var g;for(f[8]=f[13]=f[18]=f[23]="-",f[14]="4",d=0;36>d;d++)f[d]||(g=0|16*Math.random(),f[d]=e[19==d?3&g|8:g])}return f.join("")}}(),clamp:function(a,b,c){return b>a?b:a>c?c:a},degToRad:function(){var a=Math.PI/180;return function(b){return b*a}}()},Zia.Matrix4=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){this.elements=new Float32Array(16);var q=this.elements;q[0]=void 0!==a?a:1,q[4]=b||0,q[8]=c||0,q[12]=d||0,q[1]=e||0,q[5]=void 0!==f?f:1,q[9]=g||0,q[13]=h||0,q[2]=i||0,q[6]=j||0,q[10]=void 0!==k?k:1,q[14]=l||0,q[3]=m||0,q[7]=n||0,q[11]=o||0,q[15]=void 0!==p?p:1},Zia.Matrix4.prototype={constructor:Zia.Matrix4,set:function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=this.elements;return q[0]=a,q[4]=b,q[8]=c,q[12]=d,q[1]=e,q[5]=f,q[9]=g,q[13]=h,q[2]=i,q[6]=j,q[10]=k,q[14]=l,q[3]=m,q[7]=n,q[11]=o,q[15]=p,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(a){return this.elements.set(a.elements),this},copyPosition:function(a){var b=this.elements,c=a.elements;return b[12]=c[12],b[13]=c[13],b[14]=c[14],this},extractRotation:function(){var a=new Zia.Vector3;return function(b){var c=this.elements,d=b.elements,e=1/a.set(d[0],d[1],d[2]).length(),f=1/a.set(d[4],d[5],d[6]).length(),g=1/a.set(d[8],d[9],d[10]).length();return c[0]=d[0]*e,c[1]=d[1]*e,c[2]=d[2]*e,c[4]=d[4]*f,c[5]=d[5]*f,c[6]=d[6]*f,c[8]=d[8]*g,c[9]=d[9]*g,c[10]=d[10]*g,this}}(),makeRotationFromEuler:function(a){a instanceof Zia.Euler==!1&&console.error("Zia.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var b=this.elements,c=a.x,d=a.y,e=a.z,f=Math.cos(c),g=Math.sin(c),h=Math.cos(d),i=Math.sin(d),j=Math.cos(e),k=Math.sin(e);if("XYZ"===a.order){var l=f*j,m=f*k,n=g*j,o=g*k;b[0]=h*j,b[4]=-h*k,b[8]=i,b[1]=m+n*i,b[5]=l-o*i,b[9]=-g*h,b[2]=o-l*i,b[6]=n+m*i,b[10]=f*h}else if("YXZ"===a.order){var p=h*j,q=h*k,r=i*j,s=i*k;b[0]=p+s*g,b[4]=r*g-q,b[8]=f*i,b[1]=f*k,b[5]=f*j,b[9]=-g,b[2]=q*g-r,b[6]=s+p*g,b[10]=f*h}else if("ZXY"===a.order){var p=h*j,q=h*k,r=i*j,s=i*k;b[0]=p-s*g,b[4]=-f*k,b[8]=r+q*g,b[1]=q+r*g,b[5]=f*j,b[9]=s-p*g,b[2]=-f*i,b[6]=g,b[10]=f*h}else if("ZYX"===a.order){var l=f*j,m=f*k,n=g*j,o=g*k;b[0]=h*j,b[4]=n*i-m,b[8]=l*i+o,b[1]=h*k,b[5]=o*i+l,b[9]=m*i-n,b[2]=-i,b[6]=g*h,b[10]=f*h}else if("YZX"===a.order){var t=f*h,u=f*i,v=g*h,w=g*i;b[0]=h*j,b[4]=w-t*k,b[8]=v*k+u,b[1]=k,b[5]=f*j,b[9]=-g*j,b[2]=-i*j,b[6]=u*k+v,b[10]=t-w*k}else if("XZY"===a.order){var t=f*h,u=f*i,v=g*h,w=g*i;b[0]=h*j,b[4]=-k,b[8]=i*j,b[1]=t*k+w,b[5]=f*j,b[9]=u*k-v,b[2]=v*k-u,b[6]=g*j,b[10]=w*k+t}return b[3]=0,b[7]=0,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,this},makeRotationFromQuaternion:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z,f=a.w,g=c+c,h=d+d,i=e+e,j=c*g,k=c*h,l=c*i,m=d*h,n=d*i,o=e*i,p=f*g,q=f*h,r=f*i;return b[0]=1-(m+o),b[4]=k-r,b[8]=l+q,b[1]=k+r,b[5]=1-(j+o),b[9]=n-p,b[2]=l-q,b[6]=n+p,b[10]=1-(j+m),b[3]=0,b[7]=0,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,this},lookAt:function(){var a=new Zia.Vector3,b=new Zia.Vector3,c=new Zia.Vector3;return function(d,e,f){var g=this.elements;return c.subVectors(d,e).normalize(),0===c.length()&&(c.z=1),a.crossVectors(f,c).normalize(),0===a.length()&&(c.x+=1e-4,a.crossVectors(f,c).normalize()),b.crossVectors(c,a),g[0]=a.x,g[4]=b.x,g[8]=c.x,g[1]=a.y,g[5]=b.y,g[9]=c.y,g[2]=a.z,g[6]=b.z,g[10]=c.z,this}}(),multiply:function(a){return this.multiplyMatrices(this,a)},multiplyMatrices:function(a,b){var c=a.elements,d=b.elements,e=this.elements,f=c[0],g=c[4],h=c[8],i=c[12],j=c[1],k=c[5],l=c[9],m=c[13],n=c[2],o=c[6],p=c[10],q=c[14],r=c[3],s=c[7],t=c[11],u=c[15],v=d[0],w=d[4],x=d[8],y=d[12],z=d[1],A=d[5],B=d[9],C=d[13],D=d[2],E=d[6],F=d[10],G=d[14],H=d[3],I=d[7],J=d[11],K=d[15];return e[0]=f*v+g*z+h*D+i*H,e[4]=f*w+g*A+h*E+i*I,e[8]=f*x+g*B+h*F+i*J,e[12]=f*y+g*C+h*G+i*K,e[1]=j*v+k*z+l*D+m*H,e[5]=j*w+k*A+l*E+m*I,e[9]=j*x+k*B+l*F+m*J,e[13]=j*y+k*C+l*G+m*K,e[2]=n*v+o*z+p*D+q*H,e[6]=n*w+o*A+p*E+q*I,e[10]=n*x+o*B+p*F+q*J,e[14]=n*y+o*C+p*G+q*K,e[3]=r*v+s*z+t*D+u*H,e[7]=r*w+s*A+t*E+u*I,e[11]=r*x+s*B+t*F+u*J,e[15]=r*y+s*C+t*G+u*K,this},multiplyToArray:function(a,b,c){var d=this.elements;return this.multiplyMatrices(a,b),c[0]=d[0],c[1]=d[1],c[2]=d[2],c[3]=d[3],c[4]=d[4],c[5]=d[5],c[6]=d[6],c[7]=d[7],c[8]=d[8],c[9]=d[9],c[10]=d[10],c[11]=d[11],c[12]=d[12],c[13]=d[13],c[14]=d[14],c[15]=d[15],this},multiplyScalar:function(a){var b=this.elements;return b[0]*=a,b[4]*=a,b[8]*=a,b[12]*=a,b[1]*=a,b[5]*=a,b[9]*=a,b[13]*=a,b[2]*=a,b[6]*=a,b[10]*=a,b[14]*=a,b[3]*=a,b[7]*=a,b[11]*=a,b[15]*=a,this},applyToVector3Array:function(){var a=new Zia.Vector3;return function(b,c,d){void 0===c&&(c=0),void 0===d&&(d=b.length);for(var e=0,f=c;d>e;e+=3,f+=3)a.x=b[f],a.y=b[f+1],a.z=b[f+2],a.applyMatrix4(this),b[f]=a.x,b[f+1]=a.y,b[f+2]=a.z;return b}}(),determinant:function(){var a=this.elements,b=a[0],c=a[4],d=a[8],e=a[12],f=a[1],g=a[5],h=a[9],i=a[13],j=a[2],k=a[6],l=a[10],m=a[14],n=a[3],o=a[7],p=a[11],q=a[15];return n*(+e*h*k-d*i*k-e*g*l+c*i*l+d*g*m-c*h*m)+o*(+b*h*m-b*i*l+e*f*l-d*f*m+d*i*j-e*h*j)+p*(+b*i*k-b*g*m-e*f*k+c*f*m+e*g*j-c*i*j)+q*(-d*g*j-b*h*k+b*g*l+d*f*k-c*f*l+c*h*j)},transpose:function(){var a,b=this.elements;return a=b[1],b[1]=b[4],b[4]=a,a=b[2],b[2]=b[8],b[8]=a,a=b[6],b[6]=b[9],b[9]=a,a=b[3],b[3]=b[12],b[12]=a,a=b[7],b[7]=b[13],b[13]=a,a=b[11],b[11]=b[14],b[14]=a,this},flattenToArrayOffset:function(a,b){var c=this.elements;return a[b]=c[0],a[b+1]=c[1],a[b+2]=c[2],a[b+3]=c[3],a[b+4]=c[4],a[b+5]=c[5],a[b+6]=c[6],a[b+7]=c[7],a[b+8]=c[8],a[b+9]=c[9],a[b+10]=c[10],a[b+11]=c[11],a[b+12]=c[12],a[b+13]=c[13],a[b+14]=c[14],a[b+15]=c[15],a},setPosition:function(a){var b=this.elements;return b[12]=a.x,b[13]=a.y,b[14]=a.z,this},getInverse:function(a,b){var c=this.elements,d=a.elements,e=d[0],f=d[4],g=d[8],h=d[12],i=d[1],j=d[5],k=d[9],l=d[13],m=d[2],n=d[6],o=d[10],p=d[14],q=d[3],r=d[7],s=d[11],t=d[15];c[0]=k*p*r-l*o*r+l*n*s-j*p*s-k*n*t+j*o*t,c[4]=h*o*r-g*p*r-h*n*s+f*p*s+g*n*t-f*o*t,c[8]=g*l*r-h*k*r+h*j*s-f*l*s-g*j*t+f*k*t,c[12]=h*k*n-g*l*n-h*j*o+f*l*o+g*j*p-f*k*p,c[1]=l*o*q-k*p*q-l*m*s+i*p*s+k*m*t-i*o*t,c[5]=g*p*q-h*o*q+h*m*s-e*p*s-g*m*t+e*o*t,c[9]=h*k*q-g*l*q-h*i*s+e*l*s+g*i*t-e*k*t,c[13]=g*l*m-h*k*m+h*i*o-e*l*o-g*i*p+e*k*p,c[2]=j*p*q-l*n*q+l*m*r-i*p*r-j*m*t+i*n*t,c[6]=h*n*q-f*p*q-h*m*r+e*p*r+f*m*t-e*n*t,c[10]=f*l*q-h*j*q+h*i*r-e*l*r-f*i*t+e*j*t,c[14]=h*j*m-f*l*m-h*i*n+e*l*n+f*i*p-e*j*p,c[3]=k*n*q-j*o*q-k*m*r+i*o*r+j*m*s-i*n*s,c[7]=f*o*q-g*n*q+g*m*r-e*o*r-f*m*s+e*n*s,c[11]=g*j*q-f*k*q-g*i*r+e*k*r+f*i*s-e*j*s,c[15]=f*k*m-g*j*m+g*i*n-e*k*n-f*i*o+e*j*o;var u=e*c[0]+i*c[4]+m*c[8]+q*c[12];if(0==u){var v="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(b)throw new Error(v);return console.warn(v),this.identity(),this}return this.multiplyScalar(1/u),this},scale:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z;return b[0]*=c,b[4]*=d,b[8]*=e,b[1]*=c,b[5]*=d,b[9]*=e,b[2]*=c,b[6]*=d,b[10]*=e,b[3]*=c,b[7]*=d,b[11]*=e,this},getMaxScaleOnAxis:function(){var a=this.elements,b=a[0]*a[0]+a[1]*a[1]+a[2]*a[2],c=a[4]*a[4]+a[5]*a[5]+a[6]*a[6],d=a[8]*a[8]+a[9]*a[9]+a[10]*a[10];return Math.sqrt(Math.max(b,Math.max(c,d)))},makeTranslation:function(a,b,c){return this.set(1,0,0,a,0,1,0,b,0,0,1,c,0,0,0,1),this},makeRotationX:function(a){var b=Math.cos(a),c=Math.sin(a);return this.set(1,0,0,0,0,b,-c,0,0,c,b,0,0,0,0,1),this},makeRotationY:function(a){var b=Math.cos(a),c=Math.sin(a);return this.set(b,0,c,0,0,1,0,0,-c,0,b,0,0,0,0,1),this},makeRotationZ:function(a){var b=Math.cos(a),c=Math.sin(a);return this.set(b,-c,0,0,c,b,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(a,b){var c=Math.cos(b),d=Math.sin(b),e=1-c,f=a.x,g=a.y,h=a.z,i=e*f,j=e*g;return this.set(i*f+c,i*g-d*h,i*h+d*g,0,i*g+d*h,j*g+c,j*h-d*f,0,i*h-d*g,j*h+d*f,e*h*h+c,0,0,0,0,1),this},makeScale:function(a,b,c){return this.set(a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1),this},compose:function(a,b,c){return this.makeRotationFromQuaternion(b),this.scale(c),this.setPosition(a),this},decompose:function(){var a=new Zia.Vector3,b=new Zia.Matrix4;return function(c,d,e){var f=this.elements,g=a.set(f[0],f[1],f[2]).length(),h=a.set(f[4],f[5],f[6]).length(),i=a.set(f[8],f[9],f[10]).length(),j=this.determinant();0>j&&(g=-g),c.x=f[12],c.y=f[13],c.z=f[14],b.elements.set(this.elements);var k=1/g,l=1/h,m=1/i;return b.elements[0]*=k,b.elements[1]*=k,b.elements[2]*=k,b.elements[4]*=l,b.elements[5]*=l,b.elements[6]*=l,b.elements[8]*=m,b.elements[9]*=m,b.elements[10]*=m,d.setFromRotationMatrix(b),e.x=g,e.y=h,e.z=i,this}}(),makeFrustum:function(a,b,c,d,e,f){var g=this.elements,h=2*e/(b-a),i=2*e/(d-c),j=(b+a)/(b-a),k=(d+c)/(d-c),l=-(f+e)/(f-e),m=-2*f*e/(f-e);return g[0]=h,g[4]=0,g[8]=j,g[12]=0,g[1]=0,g[5]=i,g[9]=k,g[13]=0,g[2]=0,g[6]=0,g[10]=l,g[14]=m,g[3]=0,g[7]=0,g[11]=-1,g[15]=0,this},makePerspective:function(a,b,c,d){var e=c*Math.tan(.5*a),f=-e,g=f*b,h=e*b;return this.makeFrustum(g,h,f,e,c,d)},makeOrthographic:function(a,b,c,d,e,f){var g=this.elements,h=b-a,i=c-d,j=f-e,k=(b+a)/h,l=(c+d)/i,m=(f+e)/j;return g[0]=2/h,g[4]=0,g[8]=0,g[12]=-k,g[1]=0,g[5]=2/i,g[9]=0,g[13]=-l,g[2]=0,g[6]=0,g[10]=-2/j,g[14]=-m,g[3]=0,g[7]=0,g[11]=0,g[15]=1,this},fromArray:function(a){return this.elements.set(a),this},toArray:function(){var a=this.elements;return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15]]},clone:function(){var a=this.elements;return new Zia.Matrix4(a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15])}},Zia.Vector2=function(a,b){this._x=a||0,this._y=b||0},Zia.Vector2.prototype={constructor:Zia.Vector2,get x(){return this._x},set x(a){this._x=a,this._onChangeCallback()},get y(){return this._y},set y(a){this._y=a,this._onChangeCallback()},set:function(a,b){return this._x=a,this._y=b,this._onChangeCallback(),this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;default:throw new Error("index is out of range: "+a)}},getComponent:function(a){switch(a){case 0:return this._x;case 1:return this._y;default:throw new Error("index is out of range: "+a)}},copy:function(a){return this._x=a._x,this._y=a._y,this._onChangeCallback(),this},add:function(a){return this._x+=a._x,this._y+=a._y,this._onChangeCallback(),this},addVectors:function(a,b){return this._x=a._x+b._x,this._y=a._y+b._y,this._onChangeCallback(),this},addScalar:function(a){return this._x+=a,this._y+=a,this._onChangeCallback(),this},sub:function(a){return this._x-=a._x,this._y-=a._y,this._onChangeCallback(),this},subVectors:function(a,b){return this._x=a._x-b._x,this._y=a._y-b._y,this._onChangeCallback(),this},multiply:function(a){return this._x*=a._x,this._y*=a._y,this._onChangeCallback(),this},multiplyScalar:function(a){return this._x*=a,this._y*=a,this._onChangeCallback(),this},divide:function(a){return this._x/=a._x,this._y/=a._y,this._onChangeCallback(),this},divideScalar:function(a){if(0!==a){var b=1/a;this._x*=b,this._y*=b}else this._x=0,this._y=0;return this._onChangeCallback(),this},min:function(a){return this._x>a._x&&(this._x=a._x),this._y>a._y&&(this._y=a._y),this._onChangeCallback(),this},max:function(a){return this._x<a._x&&(this._x=a._x),this._y<a._y&&(this._y=a._y),this._onChangeCallback(),this},clamp:function(a,b){return this._x<a._x?this._x=a._x:this._x>b._x&&(this._x=b._x),this._y<a._y?this._y=a._y:this._y>b._y&&(this._y=b._y),this._onChangeCallback(),this},clampScalar:function(){var a,b;return function(c,d){return void 0===a&&(a=new Zia.Vector2,b=new Zia.Vector2),a.set(c,c),b.set(d,d),this.clamp(a,b)}}(),floor:function(){return this._x=Math.floor(this._x),this._y=Math.floor(this._y),this._onChangeCallback(),this},ceil:function(){return this._x=Math.ceil(this._x),this._y=Math.ceil(this._y),this._onChangeCallback(),this},round:function(){return this._x=Math.round(this._x),this._y=Math.round(this._y),this._onChangeCallback(),this},roundToZero:function(){return this._x=this._x<0?Math.ceil(this._x):Math.floor(this._x),this._y=this._y<0?Math.ceil(this._y):Math.floor(this._y),this._onChangeCallback(),this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this._x*a._x+this._y*a._y},lengthSq:function(){return this._x*this._x+this._y*this._y},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this._x-a._x,c=this._y-a._y;return b*b+c*c},setLength:function(a){var b=this.length();return 0!==b&&a!==b&&this.multiplyScalar(a/b),this},lerp:function(a,b){return this._x+=(a._x-this._x)*b,this._y+=(a._y-this._y)*b,this._onChangeCallback(),this},equals:function(a){return a._x===this._x&&a._y===this._y},fromArray:function(a){return this._x=a[0],this._y=a[1],this._onChangeCallback(),this},toArray:function(){return[this._x,this._y]},onChange:function(a){return this._onChangeCallback=a,this},_onChangeCallback:function(){},clone:function(){return new Zia.Vector2(this._x,this._y)},toJS:function(){return[this._x,this._y]}},Zia.Vector4=function(a,b,c,d){this._x=a||0,this._y=b||0,this._z=c||0,this._w=void 0!==d?d:1},Zia.Vector4.prototype={constructor:Zia.Vector4,get x(){return this._x},set x(a){this._x=a,this._onChangeCallback()},get y(){return this._y},set y(a){this._y=a,this._onChangeCallback()},get z(){return this._z},set z(a){this._z=a,this._onChangeCallback()},get w(){return this._w},set w(a){this._w=a,this._onChangeCallback()},set:function(a,b,c,d){return this._x=a,this._y=b,this._z=c,this._w=d,this._onChangeCallback(),this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;case 3:this.w=b;break;default:throw new Error("index is out of range: "+a)}},getComponent:function(a){switch(a){case 0:return this._x;case 1:return this._y;case 2:return this._z;case 3:return this._w;default:throw new Error("index is out of range: "+a)}},copy:function(a){return this._x=a._x,this._y=a._y,this._z=a._z,this._w=void 0!==a._w?a._w:1,this._onChangeCallback(),this},add:function(a){return this._x+=a._x,this._y+=a._y,this._z+=a._z,this._w+=a._w,this._onChangeCallback(),this},addScalar:function(a){return this._x+=a,this._y+=a,this._z+=a,this._w+=a,this._onChangeCallback(),this},addVectors:function(a,b){return this._x=a._x+b._x,this._y=a._y+b._y,this._z=a._z+b._z,this._w=a._w+b._w,this._onChangeCallback(),this},sub:function(a){return this._x-=a._x,this._y-=a._y,this._z-=a._z,this._w-=a._w,this._onChangeCallback(),this},subVectors:function(a,b){return this._x=a._x-b._x,this._y=a._y-b._y,this._z=a._z-b._z,this._w=a._w-b._w,this._onChangeCallback(),this},multiplyScalar:function(a){return this._x*=a,this._y*=a,this._z*=a,this._w*=a,this._onChangeCallback(),this},applyMatrix4:function(a){var b=this._x,c=this._y,d=this._z,e=this._w,f=a.elements;return this._x=f[0]*b+f[4]*c+f[8]*d+f[12]*e,this._y=f[1]*b+f[5]*c+f[9]*d+f[13]*e,this._z=f[2]*b+f[6]*c+f[10]*d+f[14]*e,this._w=f[3]*b+f[7]*c+f[11]*d+f[15]*e,this._onChangeCallback(),this},divideScalar:function(a){if(0!==a){var b=1/a;this._x*=b,this._y*=b,this._z*=b,this._w*=b}else this._x=0,this._y=0,this._z=0,this._w=1;return this._onChangeCallback(),this},setAxisAngleFromQuaternion:function(a){this._w=2*Math.acos(a._w);var b=Math.sqrt(1-a._w*a._w);return 1e-4>b?(this._x=1,this._y=0,this._z=0):(this._x=_q.x/b,this._y=_q.y/b,this._z=_q.z/b),this._onChangeCallback(),this},setAxisAngleFromRotationMatrix:function(a){var b,c,d,e,f=.01,g=.1,h=a.elements,i=h[0],j=h[4],k=h[8],l=h[1],m=h[5],n=h[9],o=h[2],p=h[6],q=h[10];if(Math.abs(j-l)<f&&Math.abs(k-o)<f&&Math.abs(n-p)<f){if(Math.abs(j+l)<g&&Math.abs(k+o)<g&&Math.abs(n+p)<g&&Math.abs(i+m+q-3)<g)return this.set(1,0,0,0),this;b=Math.PI;var r=(i+1)/2,s=(m+1)/2,t=(q+1)/2,u=(j+l)/4,v=(k+o)/4,w=(n+p)/4;return r>s&&r>t?f>r?(c=0,d=.707106781,e=.707106781):(c=Math.sqrt(r),d=u/c,e=v/c):s>t?f>s?(c=.707106781,d=0,e=.707106781):(d=Math.sqrt(s),c=u/d,e=w/d):f>t?(c=.707106781,d=.707106781,e=0):(e=Math.sqrt(t),c=v/e,d=w/e),this.set(c,d,e,b),this}var x=Math.sqrt((p-n)*(p-n)+(k-o)*(k-o)+(l-j)*(l-j));return Math.abs(x)<.001&&(x=1),this._x=(p-n)/x,this._y=(k-o)/x,this._z=(l-j)/x,this._w=Math.acos((i+m+q-1)/2),this._onChangeCallback(),this},min:function(a){return this._x>a._x&&(this._x=a._x),this._y>a._y&&(this._y=a._y),this._z>a._z&&(this._z=a._z),this._w>a._w&&(this._w=a._w),this._onChangeCallback(),this},max:function(a){return this._x<a._x&&(this._x=a._x),this._y<a._y&&(this._y=a._y),this._z<a._z&&(this._z=a._z),this._w<a._w&&(this._w=a._w),this._onChangeCallback(),this},clamp:function(a,b){return this._x<a._x?this._x=a._x:this._x>b._x&&(this._x=b._x),this._y<a._y?this._y=a._y:this._y>b._y&&(this._y=b._y),this._z<a._z?this._z=a._z:this._z>b._z&&(this._z=b._z),this._w<a._w?this._w=a._w:this._w>b._w&&(this._w=b._w),this._onChangeCallback(),this},clampScalar:function(){var a,b;return function(c,d){return void 0===a&&(a=new Zia.Vector4,b=new Zia.Vector4),a.set(c,c,c,c),b.set(d,d,d,d),this.clamp(a,b)}}(),floor:function(){return this._x=Math.floor(this._x),this._y=Math.floor(this._y),this._z=Math.floor(this._z),this._w=Math.floor(this._w),this._onChangeCallback(),this},ceil:function(){return this._x=Math.ceil(this._x),this._y=Math.ceil(this._y),this._z=Math.ceil(this._z),this._w=Math.ceil(this._w),this._onChangeCallback(),this},round:function(){return this._x=Math.round(this._x),this._y=Math.round(this._y),this._z=Math.round(this._z),this._w=Math.round(this._w),this._onChangeCallback(),this},roundToZero:function(){return this._x=this._x<0?Math.ceil(this._x):Math.floor(this._x),this._y=this._y<0?Math.ceil(this._y):Math.floor(this._y),this._z=this._z<0?Math.ceil(this._z):Math.floor(this._z),this._w=this._w<0?Math.ceil(this._w):Math.floor(this._w),this._onChangeCallback(),this},negate:function(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this._w=-this._w,this._onChangeCallback(),this},dot:function(a){return this._x*a._x+this._y*a._y+this._z*a._z+this._w*a._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},lengthManhattan:function(){return Math.abs(this._x)+Math.abs(this._y)+Math.abs(this._z)+Math.abs(this._w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){var b=this.length();return 0!==b&&a!==b&&this.multiplyScalar(a/b),this},lerp:function(a,b){return this._x+=(a._x-this._x)*b,this._y+=(a._y-this._y)*b,this._z+=(a._z-this._z)*b,this._w+=(a._w-this._w)*b,this._onChangeCallback(),this},equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._w===this._w},fromArray:function(a){return this._x=a[0],this._y=a[1],this._z=a[2],this._w=a[3],this._onChangeCallback(),this},toArray:function(){return[this._x,this._y,this._z,this._w]},clone:function(){return new Zia.Vector4(this._x,this._y,this._z,this._w)},onChange:function(a){return this._onChangeCallback=a,this},_onChangeCallback:function(){},suppressChangeCallback:function(a){var b=this._onChangeCallback;this._onChangeCallback=function(){},a(),this._onChangeCallback=b}},function(){function a(a,b){function c(a,b){return{location:b,name:a.name,size:a.size,type:a.type}}for(var d={attributes:[],uniforms:[]},e=a.getProgramParameter(b,a.ACTIVE_UNIFORMS),f=a.getProgramParameter(b,a.ACTIVE_ATTRIBUTES),g=0;e>g;g++){var h=a.getActiveUniform(b,g);d.uniforms.push(c(h,a.getUniformLocation(b,h.name)))}for(var g=0;f>g;g++){var i=a.getActiveAttrib(b,g);d.attributes.push(c(i,a.getAttribLocation(b,i.name)))}return d}Zia.Program=function(b,c,d){this._graphicsDevice=b;var e=this._gl=b._gl,f=e.createProgram();e.attachShader(f,c._shader),e.attachShader(f,d._shader),e.linkProgram(f);var g=e.getProgramParameter(f,e.LINK_STATUS);if(!g){var h=e.getProgramInfoLog(f);throw e.deleteProgram(f),new Error("Failed to link program: "+h)}this._program=f;var i=a(this._gl,this._program);this._attributes=i.attributes,this._uniforms=i.uniforms,this._uniformsByName={};for(var j=0;j<this._uniforms.length;j++){var k=this._uniforms[j];this._uniformsByName[k.name]=k}}}(),Zia.Program.prototype={apply:function(){this._graphicsDevice._currentProgram=this,this._gl.useProgram(this._program),this._onApply()},_onApply:function(){},setUniform:function(){var a=new Zia.Vector4;return function(b,c){c instanceof Zia.Color4&&(a.set(c.r,c.g,c.b,c.a),c=a);var d=this._uniformsByName[b];if(void 0!==d){var e=this._gl;switch(d.type){case e.FLOAT:e.uniform1f(d.location,c);break;case e.FLOAT_VEC2:e.uniform2f(d.location,c._x,c._y);break;case e.FLOAT_VEC3:e.uniform3f(d.location,c._x,c._y,c._z);break;case e.FLOAT_VEC4:e.uniform4f(d.location,c.x,c.y,c.z,c.w);break;case e.FLOAT_MAT3:e.uniformMatrix3fv(d.location,!1,c.elements);break;case e.FLOAT_MAT4:e.uniformMatrix4fv(d.location,!1,c.elements);break;case e.SAMPLER_2D:null!==c&&c._ready===!0&&(e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,c._texture),e.uniform1i(d.location,0));break;default:throw"Not implemented for type: "+d.type}}}}(),destroy:function(){for(var a=this._gl.getAttachedShaders(this._program),b=0;b<a.length;b++)this._gl.detachShader(this._program,a[b]);this._gl.deleteProgram(this._program)}},Zia.Comparison={Never:0,Always:1,Less:2,Equal:3,LessEqual:4,Greater:5,GreaterEqual:6,NotEqual:7},Zia.DepthStencilState=function(){this.isDepthEnabled=!0,this.depthFunction=Zia.Comparison.Less},function(){function a(a,b){switch(a){case Zia.Comparison.Never:return b.NEVER;case Zia.Comparison.Always:return b.ALWAYS;case Zia.Comparison.Less:return b.LESS;case Zia.Comparison.Equal:return b.EQUAL;case Zia.Comparison.LessEqual:return b.LEQUAL;case Zia.Comparison.Greater:return b.GREATER;case Zia.Comparison.GreaterEqual:return b.GEQUAL;case Zia.Comparison.NotEqual:return b.NOTEQUAL}}Zia.DepthStencilState.prototype={_apply:function(b){this.isDepthEnabled?(b.enable(b.DEPTH_TEST),b.depthFunc(a(this.depthFunction,b))):b.disable(b.DEPTH_TEST)}}}(),Zia.DirectionalLight=function(a,b){this._program=a,this._index=b,this.direction=new Zia.Vector3,this.diffuseColor=new Zia.Vector3,this.specularColor=new Zia.Vector3,this.enabled=!1},Zia.DirectionalLight.prototype={get direction(){return this._direction},set direction(a){this._direction=a,this._directionChanged=!0},get diffuseColor(){return this._diffuseColor},set diffuseColor(a){this._diffuseColor=a,this._diffuseColorChanged=!0},get specularColor(){return this._specularColor},set specularColor(a){this._specularColor=a,this._specularColorChanged=!0},get enabled(){return this._enabled},set enabled(a){this._enabled=a,this._enabledChanged=!0},_apply:function(){var a=new Zia.Vector3;return function(){this._directionChanged&&(this._program.setUniform("uDirLight"+index+"Direction",this._direction),this._directionChanged=!1),this._diffuseColorChanged&&this._enabled&&(this._program.setUniform("uDirLight"+index+"DiffuseColor",this._diffuseColor),this._diffuseColorChanged=!1),this._specularColorChanged&&this._enabled&&(this._program.setUniform("uDirLight"+index+"SpecularColor",this._specularColor),this._specularColorChanged=!1),this._enabledChanged&&(this._enabled||(this._program.setUniform("uDirLight"+index+"DiffuseColor",a),this._program.setUniform("uDirLight"+index+"SpecularColor",a)),this._enabledChanged=!1)}}()},Zia.ClearOptions={DepthBuffer:0,StencilBuffer:1,ColorBuffer:2},Zia.PrimitiveType={PointList:0,LineList:1,LineStrip:2,LineLoop:3,TriangleList:4,TriangleStrip:5,TriangleFan:6},Zia.GraphicsDevice=function(a,b){a.width=a.clientWidth,a.height=a.clientHeight,this._canvas=a;var c=this._gl=a.getContext("webgl",{antialias:!0});b&&(c=this._gl=Zia.DebugUtil.makeDebugContext(c)),c.enable(c.DEPTH_TEST),c.depthFunc(c.LEQUAL);var d=this._viewport=new Zia.Viewport(0,0,c.drawingBufferWidth,c.drawingBufferHeight);d.onChange(function(){c.viewport(d._x,d._y,d._width,d._height),c.depthRange(d._minDepth,d._maxDepth)}),this.rasterizerState=new Zia.RasterizerState,this.depthStencilState=new Zia.DepthStencilState},Zia.GraphicsDevice.prototype={get viewport(){return this._viewport},get rasterizerState(){return this._rasterizerState},set rasterizerState(a){this._rasterizerState=a,this._rasterizerState._apply(this._gl)},get depthStencilState(){return this._depthStencilState},set depthStencilState(a){this._depthStencilState=a,this._depthStencilState._apply(this._gl)},clear:function(a,b,c,d){var e=0;Zia.EnumUtil.hasFlag(a,Zia.ClearOptions.DepthBuffer)&&(e|=this._gl.DEPTH_BUFFER_BIT,this._gl.clearDepth(c)),Zia.EnumUtil.hasFlag(a,Zia.ClearOptions.StencilBuffer)&&(e|=this._gl.STENCIL_BUFFER_BIT,this._gl.clearStencil(d)),Zia.EnumUtil.hasFlag(a,Zia.ClearOptions.ColorBuffer)&&(e|=this._gl.COLOR_BUFFER_BIT,this._gl.clearColor(b.r,b.g,b.b,b.a)),this._gl.clear(e)},setIndexBuffer:function(a){this._indexBuffer=a},setVertexBuffers:function(a){this._vertexBuffers=a},drawIndexedPrimitives:function(a,b,c){var d=this._gl,e=this._bindVertexAttributes(d);d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,this._indexBuffer._buffer),d.drawElements(this._getMode(a),c,d.UNSIGNED_SHORT,4*b);for(var f=0;f<e.length;f++)d.disableVertexAttribArray(e[f])},drawPrimitives:function(a,b,c){var d=this._gl,e=this._bindVertexAttributes(d);d.drawArrays(this._getMode(a),b,c);for(var f=0;f<e.length;f++)d.disableVertexAttribArray(e[f])},resize:function(){var a=this._canvas,b=a.clientWidth,c=a.clientHeight;return a.width!=b||a.height!=c?(a.width=b,a.height=c,this.viewport.set(0,0,b,c),!0):!1},_bindVertexAttributes:function(a){for(var b=[],c=0;c<this._currentProgram._attributes.length;c++){var d=this._currentProgram._attributes[c],e=this._findVertexBuffer(d.name);e&&(b.push(d.location),a.bindBuffer(a.ARRAY_BUFFER,e.buffer._buffer),a.vertexAttribPointer(d.location,e.element.numComponents,a.FLOAT,!1,e.buffer._vertexDeclaration.stride,e.element.offset),a.enableVertexAttribArray(d.location))}return b},_findVertexBuffer:function(a){for(var b=0;b<this._vertexBuffers.length;b++)for(var c=this._vertexBuffers[b],d=0;d<c._vertexDeclaration.elements.length;d++){var e=c._vertexDeclaration.elements[d];if(e.attributeName===a)return{buffer:c,element:e}}return null},_getMode:function(a){switch(a){case Zia.PrimitiveType.PointList:return this._gl.POINTS;case Zia.PrimitiveType.LineList:return this._gl.LINES;case Zia.PrimitiveType.LineStrip:return this._gl.LINE_STRIP;case Zia.PrimitiveType.LineLoop:return this._gl.LINE_LOOP;case Zia.PrimitiveType.TriangleList:return this._gl.TRIANGLES;case Zia.PrimitiveType.TriangleStrip:return this._gl.TRIANGLE_STRIP;case Zia.PrimitiveType.TriangleFan:return this._gl.TRIANGLE_FAN}}},Zia.IndexBuffer=function(a,b){this._gl=a._gl,this._buffer=this._gl.createBuffer(),void 0!==b&&this.setData(b)},Zia.IndexBuffer.prototype={setData:function(a){var b=this._gl;b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this._buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,a,b.STATIC_DRAW)},destroy:function(){this._gl.deleteBuffer(this._buffer)}},Zia.CullMode={Back:0,Front:1,FrontAndBack:2,None:3},Zia.RasterizerState=function(){this.cullMode=Zia.CullMode.Back,this.isFrontClockwise=!1,this.isPolygonOffsetEnabled=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0},Zia.RasterizerState.prototype={_apply:function(a){switch(this.cullMode){case Zia.CullMode.Back:a.enable(a.CULL_FACE),a.cullFace(a.BACK);break;case Zia.CullMode.Front:a.enable(a.CULL_FACE),a.cullFace(a.FRONT);break;case Zia.CullMode.FrontAndBack:a.enable(a.CULL_FACE),a.cullFace(a.FRONT_AND_BACK);break;case Zia.CullMode.None:a.disable(a.CULL_FACE)}a.frontFace(this.isFrontClockwise?a.CW:a.CCW),this.isPolygonOffsetEnabled?(a.enable(a.POLYGON_OFFSET_FILL),a.polygonOffset(this.polygonOffsetFactor,this.polygonOffsetUnits)):a.disable(a.POLYGON_OFFSET_FILL)}},Zia.Shader=function(a,b,c){var d=this._gl=a._gl,e=d.createShader(b);if(d.shaderSource(e,c),d.compileShader(e),!d.getShaderParameter(e,d.COMPILE_STATUS)){var f=d.getShaderInfoLog(e);throw d.deleteShader(e),new Error("Failed to compile shader: "+f)}this._shader=e},Zia.Shader.prototype={destroy:function(){this._gl.deleteShader(this._shader)}},Zia.FragmentShader=function(a,b){Zia.Shader.call(this,a,a._gl.FRAGMENT_SHADER,b)},Zia.FragmentShader.prototype=Object.create(Zia.Shader.prototype),Zia.VertexShader=function(a,b){Zia.Shader.call(this,a,a._gl.VERTEX_SHADER,b)},Zia.VertexShader.prototype=Object.create(Zia.Shader.prototype),Zia.Texture=function(a,b){this._gl=a._gl,this._texture=this._gl.createTexture(),this._ready=!1,this._options=Zia.ObjectUtil.reverseMerge(b||{},{filter:Zia.TextureFilter.MinNearestMagMipLinear,wrapS:Zia.TextureWrap.Repeat,wrapT:Zia.TextureWrap.Repeat})},Zia.Texture.createFromImagePath=function(a,b,c){var d=new Zia.Texture(a,c),e=a._gl,f=new Image;return f.onload=function(){return function(){d._handleImageLoad(function(){e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,f)})}}(this),f.src=b,d},Zia.Texture.createFromImageData=function(a,b,c,d,e){var f=new Zia.Texture(a,e),g=a._gl;return f._handleImageLoad(function(){g.texImage2D(g.TEXTURE_2D,0,g.RGBA,c,d,0,g.RGBA,g.UNSIGNED_BYTE,b)}),f},Zia.Texture.createWhiteTexture=function(){var a=new Uint8Array([255,255,255,255]);return Zia.Texture.createFromImageData(graphicsDevice,a,1,1)},Zia.Texture.prototype={_handleImageLoad:function(a){var b=this._gl;b.bindTexture(b.TEXTURE_2D,this._texture),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,!0),a(),Zia.TextureWrap._applyS(b,this._options.wrapS),Zia.TextureWrap._applyT(b,this._options.wrapT),Zia.TextureFilter._apply(b,this._options.filter),b.generateMipmap(b.TEXTURE_2D),b.bindTexture(b.TEXTURE_2D,null),this._ready=!0},unload:function(){this._gl.deleteTexture(this._texture)}},Zia.TextureFilter={MinMagMipNearest:0,MinMagNearestMipLinear:1,MinNearestMagLinearMipNearest:2,MinNearestMagMipLinear:3,MinLinearMagMipNearest:4,MinLinearMagNearestMipLinear:5,MinMagLinearMipNearest:6,MinMagMipLinear:7,MinMagNearest:8,MinNearestMagLinear:9,MinLinearMagNearest:10,MinMagLinear:11,_apply:function(a,b){switch(b){case Zia.TextureFilter.MinMagMipNearest:a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST_MIPMAP_NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST);break;case Zia.TextureFilter.MinMagNearestMipLinear:a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST_MIPMAP_LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST);break;case Zia.TextureFilter.MinNearestMagLinearMipNearest:a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST_MIPMAP_NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);break;case Zia.TextureFilter.MinNearestMagMipLinear:a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST_MIPMAP_LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);break;case Zia.TextureFilter.MinLinearMagMipNearest:a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST);break;case Zia.TextureFilter.MinLinearMagNearestMipLinear:a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST);break;case Zia.TextureFilter.MinMagLinearMipNearest:a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);break;case Zia.TextureFilter.MinMagMipLinear:a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);break;case Zia.TextureFilter.MinMagNearest:a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST);break;case Zia.TextureFilter.MinNearestMagLinear:a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);break;case Zia.TextureFilter.MinLinearMagNearest:a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST);
break;case Zia.TextureFilter.MinMagLinear:a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);break;default:throw"Invalid value: "+b}}},Zia.TextureWrap={Repeat:0,ClampToEdge:1,MirroredRepeat:2,_applyS:function(a,b){Zia.TextureWrap._apply(a,a.TEXTURE_WRAP_S,b)},_applyT:function(a,b){Zia.TextureWrap._apply(a,a.TEXTURE_WRAP_T,b)},_apply:function(a,b,c){switch(c){case Zia.TextureWrap.Repeat:a.texParameteri(a.TEXTURE_2D,b,a.REPEAT);break;case Zia.TextureWrap.ClampToEdge:a.texParameteri(a.TEXTURE_2D,b,a.CLAMP_TO_EDGE);break;case Zia.TextureWrap.MirroredRepeat:a.texParameteri(a.TEXTURE_2D,b,a.MIRRORED_REPEAT);break;default:throw"Invalid value: "+filter}}},Zia.VertexBuffer=function(a,b,c){this._gl=a._gl,this._buffer=this._gl.createBuffer(),this._vertexDeclaration=b,void 0!==c&&this.setData(c)},Zia.VertexBuffer.prototype={setData:function(a){var b=this._gl;b.bindBuffer(b.ARRAY_BUFFER,this._buffer),b.bufferData(b.ARRAY_BUFFER,a,b.STATIC_DRAW)},destroy:function(){this._gl.deleteBuffer(this._buffer)}},Zia.VertexElement=function(a,b,c){this.attributeName=a,this.numComponents=b,this.offset=void 0!==c?c:0},Zia.VertexDeclaration=function(a){this.elements=a,this.stride=4*a.map(function(a){return a.numComponents}).reduce(function(a,b){return a+b},0)},Zia.Viewport=function(a,b,c,d,e,f){this._x=a,this._y=b,this._width=c,this._height=d,this._minDepth=void 0!==e?e:0,this._maxDepth=void 0!==f?f:1},Zia.Viewport.prototype={get x(){return this._x},set x(a){this._x=a,this._onChangeCallback()},get y(){return this._y},set y(a){this._y=a,this._onChangeCallback()},get width(){return this._width},set width(a){this._width=a,this._onChangeCallback()},get height(){return this._height},set height(a){this._height=a,this._onChangeCallback()},get minDepth(){return this._minDepth},set minDepth(a){this._minDepth=a,this._onChangeCallback()},get maxDepth(){return this._maxDepth},set maxDepth(a){this._maxDepth=a,this._onChangeCallback()},get aspectRatio(){return 0==this._height||0==this._width?0:this._width/this._height},set:function(a,b,c,d,e,f){this._x=a,this._y=b,this._width=c,this._height=d,void 0!==e&&(this._minDepth=e),void 0!==f&&(this._maxDepth=f),this._onChangeCallback()},onChange:function(a){return this._onChangeCallback=a,this},_onChangeCallback:function(){},suppressChangeCallback:function(a){var b=this._onChangeCallback;this._onChangeCallback=function(){},a(),this._onChangeCallback=b}},Zia.BoxPrimitive={vertexDeclaration:new Zia.VertexDeclaration([new Zia.VertexElement("aVertexPosition",3,0),new Zia.VertexElement("aTextureCoord",2,12)]),vertices:new Float32Array([-1,-1,1,0,0,1,-1,1,1,0,1,1,1,1,1,-1,1,1,0,1,-1,-1,-1,0,0,-1,1,-1,1,0,1,1,-1,1,1,1,-1,-1,0,1,-1,1,-1,0,0,-1,1,1,1,0,1,1,1,1,1,1,1,-1,0,1,-1,-1,-1,0,0,1,-1,-1,1,0,1,-1,1,1,1,-1,-1,1,0,1,1,-1,-1,0,0,1,1,-1,1,0,1,1,1,1,1,1,-1,1,0,1,-1,-1,-1,0,0,-1,-1,1,1,0,-1,1,1,1,1,-1,1,-1,0,1]),indices:new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23])},function(){function a(a){a.push("uniform vec3 uDirLight0Direction"),a.push("uniform vec3 uDirLight0DiffuseColor"),a.push("uniform vec3 uDirLight0SpecularColor"),a.push("uniform vec3 uDirLight1Direction"),a.push("uniform vec3 uDirLight1DiffuseColor"),a.push("uniform vec3 uDirLight1SpecularColor"),a.push("uniform vec3 uDirLight2Direction"),a.push("uniform vec3 uDirLight2DiffuseColor"),a.push("uniform vec3 uDirLight2SpecularColor"),a.push("uniform vec3 uEyePosition;"),a.push("struct ColorPair {"),a.push("  vec3 Diffuse;"),a.push("  vec3 Specular;"),a.push("};"),a.push("ColorPair ComputeLights(vec3 eyeVector, vec3 worldNormal, const int numLights) {"),a.push("  mat3 lightDirections = 0;"),a.push("  mat3 lightDiffuse = 0;"),a.push("  mat3 lightSpecular = 0;"),a.push("  mat3 halfVectors = 0;"),a.push("  for (int i = 0; i < numLights; i++) {"),a.push("    lightDirections[i] = mat3(uDirLight0Direction,     uDirLight1Direction,     uDirLight2Direction)    [i];"),a.push("    lightDiffuse[i]    = mat3(uDirLight0DiffuseColor,  uDirLight1DiffuseColor,  uDirLight2DiffuseColor) [i];"),a.push("    lightSpecular[i]   = mat3(uDirLight0SpecularColor, uDirLight1SpecularColor, uDirLight2SpecularColor)[i];"),a.push("    halfVectors[i] = normalize(eyeVector - lightDirections[i]);"),a.push("  }"),a.push("  float3 dotL = mul(-lightDirections, worldNormal);"),a.push("  float3 dotH = mul(halfVectors, worldNormal);"),a.push("  float3 zeroL = step(0, dotL);"),a.push("  float3 diffuse  = zeroL * dotL;"),a.push("  float3 specular = pow(max(dotH, 0) * zeroL, uSpecularPower);"),a.push("  ColorPair result;"),a.push("  result.Diffuse  = mul(diffuse,  lightDiffuse)  * uDiffuseColor.rgb + uEmissiveColor;"),a.push("  result.Specular = mul(specular, lightSpecular) * uSpecularColor;"),a.push("  return result;"),a.push("}")}function b(a){var b=[];return b.push("precision mediump float;"),b.push("attribute vec3 aVertexPosition;"),a.lightingEnabled&&b.push("attribute vec3 aVertexNormal;"),a.vertexColorEnabled&&b.push("attribute vec4 aVertexColor;"),a.textureEnabled&&b.push("attribute vec2 aTextureCoord;"),b.push("uniform mat4 uMVPMatrix;"),a.lightingEnabled&&(b.push("uniform mat4 uMMatrix;"),b.push("uniform mat3 uMMatrixInverseTranspose;")),b.push("uniform vec4 uDiffuseColor;"),b.push("varying vec4 vDiffuseColor;"),a.lightingEnabled&&(b.push("varying vec3 vPositionWS;"),b.push("varying vec3 vNormalWS;")),a.textureEnabled&&b.push("varying vec2 vTextureCoord;"),b.push("void main(void) {"),b.push("  gl_Position = uMVPMatrix * vec4(aVertexPosition, 1.0);"),a.lightingEnabled?(b.push("  vDiffuseColor = vec4(1, 1, 1, uDiffuseColor.a);"),b.push("  vPositionWS = uMMatrix * vec4(aVertexPosition, 1.0).xyz;"),b.push("  vNormalWS = normalize(uMMatrixInverseTranspose * aVertexNormal);")):b.push("  vDiffuseColor = uDiffuseColor;"),a.vertexColorEnabled&&b.push("  vDiffuseColor *= aVertexColor;"),a.textureEnabled&&b.push("  vTextureCoord = aTextureCoord;"),b.push("}"),b.join("\n")}function c(b){var c=[];return c.push("precision mediump float;"),c.push("varying vec4 vDiffuseColor;"),b.textureEnabled&&(c.push("varying vec2 vTextureCoord;"),c.push("uniform sampler2D uSampler;")),b.lightingEnabled&&a(c),c.push("void main(void) {"),c.push("  vec4 color = vDiffuseColor;"),b.textureEnabled&&c.push("  color *= texture2D(uSampler, vTextureCoord);"),b.lightingEnabled&&(c.push("  vec3 eyeVector = normalize(uEyePosition - vPositionWS.xyz);"),c.push("  vec3 worldNormal = normalize(vNormalWS);"),c.push("  ColorPair lightResult = ComputeLights(eyeVector, worldNormal, 3);"),c.push("  color.rgb *= lightResult.Diffuse;")),c.push("  gl_FragColor = color;"),c.push("}"),c.join("\n")}Zia.BasicProgram=function(a,d){this.model=new Zia.Matrix4,this.view=new Zia.Matrix4,this.projection=new Zia.Matrix4,this.diffuseColor=new Zia.Vector3(1,1,1),this.alpha=1,this.texture=null,this._directionalLight0=new Zia.DirectionalLight(this,0),this._directionalLight1=new Zia.DirectionalLight(this,0),this._directionalLight2=new Zia.DirectionalLight(this,0),d=Zia.ObjectUtil.reverseMerge(d||{},{lightingEnabled:!1,textureEnabled:!1,vertexColorEnabled:!1});var e=new Zia.VertexShader(a,b(d)),f=new Zia.FragmentShader(a,c(d));Zia.Program.call(this,a,e,f)}}(),Zia.BasicProgram.prototype=Object.create(Zia.Program.prototype,{model:{get:function(){return this._model},set:function(a){this._model=a,this._matrixChanged=!0}},view:{get:function(){return this._view},set:function(a){this._view=a,this._matrixChanged=!0}},projection:{get:function(){return this._projection},set:function(a){this._projection=a,this._matrixChanged=!0}},diffuseColor:{get:function(){return this._diffuseColor},set:function(a){this._diffuseColor=a,this._diffuseColorChanged=!0}},alpha:{get:function(){return this._alpha},set:function(a){this._alpha=a,this._diffuseColorChanged=!0}},texture:{get:function(){return this._texture},set:function(a){this._texture=a,this._textureChanged=!0}},directionalLight0:{get:function(){return this._directionalLight0}},directionalLight1:{get:function(){return this._directionalLight1}},directionalLight2:{get:function(){return this._directionalLight2}}}),Zia.BasicProgram.prototype._onApply=function(){var a=new Zia.Matrix4,b=new Zia.Matrix4,c=new Zia.Matrix4,d=new Zia.Vector3,e=new Zia.Vector4;return function(){if(this._matrixChanged&&(a.multiplyMatrices(this._projection,this._view),a.multiply(this._model),this.setUniform("uMVPMatrix",a),this.setUniform("uMMatrix",this._model),b.getInverse(this._model),b.transpose(),this.setUniform("uMMatrixInverseTranspose",b),c.getInverse(this._view),d.setFromMatrixColumn(3,c),this.setUniform("uEyePosition",d),this._matrixChanged=!1),this._diffuseColorChanged){var f=this._diffuseColor;e.set(f.x,f.y,f.z,this._alpha),this.setUniform("uDiffuseColor",e),this._diffuseColorChanged=!1}this._textureChanged&&(this.setUniform("uSampler",this._texture),this._textureChanged=!1),_directionalLight0._apply(),_directionalLight1._apply(),_directionalLight2._apply()}}(),Zia.ProgramUtil={enableDefaultLighting:function(a,b,c){return a.direction=new Zia.Vector3(-.5265408,-.5735765,-.6275069),a.diffuseColor=new Zia.Vector3(1,.9607844,.8078432),a.specularColor=new Zia.Vector3(1,.9607844,.8078432),a.enabled=!0,b.direction=new Zia.Vector3(.7198464,.3420201,.6040227),b.diffuseColor=new Zia.Vector3(.9647059,.7607844,.4078432),b.specularColor=new Zia.Vector3,b.enabled=!0,c.direction=new Zia.Vector3(.4545195,-.7660444,.4545195),c.diffuseColor=new Zia.Vector3(.3231373,.3607844,.3937255),c.specularColor=new Zia.Vector3(.3231373,.3607844,.3937255),c.enabled=!0,new Vector3(.05333332,.09882354,.1819608)}},function(){function a(a,b){throw WebGLDebugUtils.glEnumToString(a)+" was caused by call to: "+b}function b(a,b){for(var c=0;c<b.length;++c)if(void 0===b[c])throw"undefined passed to gl."+a+"("+WebGLDebugUtils.glFunctionArgsToString(a,b)+")"}Zia.DebugUtil={makeDebugContext:function(c){return WebGLDebugUtils.makeDebugContext(c,a,b)}}}(),Zia.EnumUtil={hasFlag:function(a,b){return(a&b)===b}},Zia.ObjectUtil={reverseMerge:function(a,b){for(var c in b)!b.hasOwnProperty(c)||c in a||(a[c]=b[c]);return a}};