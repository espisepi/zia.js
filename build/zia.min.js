var Zia={defaultValue:function(a,b){return void 0!==a?a:b}};/*!
 * Original code from three.js project. https://github.com/mrdoob/three.js
 * Original code published with the following license:
 *
 * The MIT License
 * 
 * Copyright &copy; 2010-2014 three.js authors
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
Zia.Quaternion=function(a,b,c,d){this._x=a||0,this._y=b||0,this._z=c||0,this._w=void 0!==d?d:1},Zia.Quaternion.prototype={constructor:Zia.Quaternion,get x(){return this._x},set x(a){this._x=a,this._onChangeCallback()},get y(){return this._y},set y(a){this._y=a,this._onChangeCallback()},get z(){return this._z},set z(a){this._z=a,this._onChangeCallback()},get w(){return this._w},set w(a){this._w=a,this._onChangeCallback()},set:function(a,b,c,d){return this._x=a,this._y=b,this._z=c,this._w=d,this._onChangeCallback(),this},copy:function(a){return this._x=a._x,this._y=a._y,this._z=a._z,this._w=a._w,this._onChangeCallback(),this},setFromEuler:function(a,b){var c=Math.cos(a._x/2),d=Math.cos(a._y/2),e=Math.cos(a._z/2),f=Math.sin(a._x/2),g=Math.sin(a._y/2),h=Math.sin(a._z/2);return"XYZ"===a.order?(this._x=f*d*e+c*g*h,this._y=c*g*e-f*d*h,this._z=c*d*h+f*g*e,this._w=c*d*e-f*g*h):"YXZ"===a.order?(this._x=f*d*e+c*g*h,this._y=c*g*e-f*d*h,this._z=c*d*h-f*g*e,this._w=c*d*e+f*g*h):"ZXY"===a.order?(this._x=f*d*e-c*g*h,this._y=c*g*e+f*d*h,this._z=c*d*h+f*g*e,this._w=c*d*e-f*g*h):"ZYX"===a.order?(this._x=f*d*e-c*g*h,this._y=c*g*e+f*d*h,this._z=c*d*h-f*g*e,this._w=c*d*e+f*g*h):"YZX"===a.order?(this._x=f*d*e+c*g*h,this._y=c*g*e+f*d*h,this._z=c*d*h-f*g*e,this._w=c*d*e-f*g*h):"XZY"===a.order&&(this._x=f*d*e-c*g*h,this._y=c*g*e-f*d*h,this._z=c*d*h+f*g*e,this._w=c*d*e+f*g*h),b!==!1&&this._onChangeCallback(),this},setFromAxisAngle:function(a,b){var c=b/2,d=Math.sin(c);return this._x=a.x*d,this._y=a.y*d,this._z=a.z*d,this._w=Math.cos(c),this._onChangeCallback(),this},setFromRotationMatrix:function(a){var b,c=a.elements,d=c[0],e=c[4],f=c[8],g=c[1],h=c[5],i=c[9],j=c[2],k=c[6],l=c[10],m=d+h+l;return m>0?(b=.5/Math.sqrt(m+1),this._w=.25/b,this._x=(k-i)*b,this._y=(f-j)*b,this._z=(g-e)*b):d>h&&d>l?(b=2*Math.sqrt(1+d-h-l),this._w=(k-i)/b,this._x=.25*b,this._y=(e+g)/b,this._z=(f+j)/b):h>l?(b=2*Math.sqrt(1+h-d-l),this._w=(f-j)/b,this._x=(e+g)/b,this._y=.25*b,this._z=(i+k)/b):(b=2*Math.sqrt(1+l-d-h),this._w=(g-e)/b,this._x=(f+j)/b,this._y=(i+k)/b,this._z=.25*b),this._onChangeCallback(),this},setFromUnitVectors:function(){var a,b,c=1e-6;return function(d,e){return void 0===a&&(a=new Zia.Vector3),b=d.dot(e)+1,c>b?(b=0,Math.abs(d.x)>Math.abs(d.z)?a.set(-d.y,d.x,0):a.set(0,-d.z,d.y)):a.crossVectors(d,e),this._x=a.x,this._y=a.y,this._z=a.z,this._w=b,this.normalize(),this}}(),inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var a=this.length();return 0===a?(this._x=0,this._y=0,this._z=0,this._w=1):(a=1/a,this._x=this._x*a,this._y=this._y*a,this._z=this._z*a,this._w=this._w*a),this._onChangeCallback(),this},multiply:function(a){return this.multiplyQuaternions(this,a)},multiplyQuaternions:function(a,b){var c=a._x,d=a._y,e=a._z,f=a._w,g=b._x,h=b._y,i=b._z,j=b._w;return this._x=c*j+f*g+d*i-e*h,this._y=d*j+f*h+e*g-c*i,this._z=e*j+f*i+c*h-d*g,this._w=f*j-c*g-d*h-e*i,this._onChangeCallback(),this},slerp:function(a,b){var c=this._x,d=this._y,e=this._z,f=this._w,g=f*a._w+c*a._x+d*a._y+e*a._z;if(0>g?(this._w=-a._w,this._x=-a._x,this._y=-a._y,this._z=-a._z,g=-g):this.copy(a),g>=1)return this._w=f,this._x=c,this._y=d,this._z=e,this;var h=Math.acos(g),i=Math.sqrt(1-g*g);if(Math.abs(i)<.001)return this._w=.5*(f+this._w),this._x=.5*(c+this._x),this._y=.5*(d+this._y),this._z=.5*(e+this._z),this;var j=Math.sin((1-b)*h)/i,k=Math.sin(b*h)/i;return this._w=f*j+this._w*k,this._x=c*j+this._x*k,this._y=d*j+this._y*k,this._z=e*j+this._z*k,this._onChangeCallback(),this},equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._w===this._w},fromArray:function(a){return this._x=a[0],this._y=a[1],this._z=a[2],this._w=a[3],this._onChangeCallback(),this},toArray:function(){return[this._x,this._y,this._z,this._w]},onChange:function(a){return this._onChangeCallback=a,this},_onChangeCallback:function(){},suppressChangeCallback:function(a){var b=this._onChangeCallback;this._onChangeCallback=function(){},a(),this._onChangeCallback=b},clone:function(){return new Zia.Quaternion(this._x,this._y,this._z,this._w)},toJS:function(){return[this._x,this._y,this._z,this._w]}},Zia.Quaternion.slerp=function(a,b,c,d){return c.copy(a).slerp(b,d)},/*!
 * Original code from three.js project. https://github.com/mrdoob/three.js
 * Original code published with the following license:
 *
 * The MIT License
 * 
 * Copyright &copy; 2010-2014 three.js authors
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
Zia.Vector3=function(a,b,c){this._x=a||0,this._y=b||0,this._z=c||0},Zia.Vector3.prototype={constructor:Zia.Vector3,get x(){return this._x},set x(a){this._x=a,this._onChangeCallback()},get y(){return this._y},set y(a){this._y=a,this._onChangeCallback()},get z(){return this._z},set z(a){this._z=a,this._onChangeCallback()},set:function(a,b,c){return this._x=a,this._y=b,this._z=c,this._onChangeCallback(),this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;default:throw new Error("index is out of range: "+a)}},getComponent:function(a){switch(a){case 0:return this._x;case 1:return this._y;case 2:return this._z;default:throw new Error("index is out of range: "+a)}},copy:function(a){return this._x=a._x,this._y=a._y,this._z=a._z,this._onChangeCallback(),this},add:function(a){return this._x+=a._x,this._y+=a._y,this._z+=a._z,this._onChangeCallback(),this},addScalar:function(a){return this._x+=a,this._y+=a,this._z+=a,this._onChangeCallback(),this},addVectors:function(a,b){return this._x=a._x+b._x,this._y=a._y+b._y,this._z=a._z+b._z,this._onChangeCallback(),this},sub:function(a){return this._x-=a._x,this._y-=a._y,this._z-=a._z,this._onChangeCallback(),this},subVectors:function(a,b){return this._x=a._x-b._x,this._y=a._y-b._y,this._z=a._z-b._z,this._onChangeCallback(),this},multiply:function(a){return this._x*=a._x,this._y*=a._y,this._z*=a._z,this._onChangeCallback(),this},multiplyScalar:function(a){return this._x*=a,this._y*=a,this._z*=a,this._onChangeCallback(),this},multiplyVectors:function(a,b){return this._x=a._x*b._x,this._y=a._y*b._y,this._z=a._z*b._z,this._onChangeCallback(),this},applyEuler:function(){var a;return function(b){return void 0===a&&(a=new Zia.Quaternion),this.applyQuaternion(a.setFromEuler(b)),this}}(),applyAxisAngle:function(){var a;return function(b,c){return void 0===a&&(a=new Zia.Quaternion),this.applyQuaternion(a.setFromAxisAngle(b,c)),this}}(),applyMatrix3:function(a){var b=this._x,c=this._y,d=this._z,e=a.elements;return this._x=e[0]*b+e[3]*c+e[6]*d,this._y=e[1]*b+e[4]*c+e[7]*d,this._z=e[2]*b+e[5]*c+e[8]*d,this._onChangeCallback(),this},applyMatrix4:function(a){var b=this._x,c=this._y,d=this._z,e=a.elements;return this._x=e[0]*b+e[4]*c+e[8]*d+e[12],this._y=e[1]*b+e[5]*c+e[9]*d+e[13],this._z=e[2]*b+e[6]*c+e[10]*d+e[14],this._onChangeCallback(),this},applyProjection:function(a){var b=this._x,c=this._y,d=this._z,e=a.elements,f=1/(e[3]*b+e[7]*c+e[11]*d+e[15]);return this._x=(e[0]*b+e[4]*c+e[8]*d+e[12])*f,this._y=(e[1]*b+e[5]*c+e[9]*d+e[13])*f,this._z=(e[2]*b+e[6]*c+e[10]*d+e[14])*f,this._onChangeCallback(),this},applyQuaternion:function(a){var b=this._x,c=this._y,d=this._z,e=a._x,f=a._y,g=a._z,h=a._w,i=h*b+f*d-g*c,j=h*c+g*b-e*d,k=h*d+e*c-f*b,l=-e*b-f*c-g*d;return this._x=i*h+l*-e+j*-g-k*-f,this._y=j*h+l*-f+k*-e-i*-g,this._z=k*h+l*-g+i*-f-j*-e,this._onChangeCallback(),this},transformDirection:function(a){var b=this._x,c=this._y,d=this._z,e=a.elements;return this._x=e[0]*b+e[4]*c+e[8]*d,this._y=e[1]*b+e[5]*c+e[9]*d,this._z=e[2]*b+e[6]*c+e[10]*d,this._onChangeCallback(),this.normalize(),this},divide:function(a){return this._x/=a._x,this._y/=a._y,this._z/=a._z,this._onChangeCallback(),this},divideScalar:function(a){if(0!==a){var b=1/a;this._x*=b,this._y*=b,this._z*=b}else this._x=0,this._y=0,this._z=0;return this._onChangeCallback(),this},min:function(a){return this._x>a._x&&(this._x=a._x),this._y>a._y&&(this._y=a._y),this._z>a._z&&(this._z=a._z),this._onChangeCallback(),this},max:function(a){return this._x<a._x&&(this._x=a._x),this._y<a._y&&(this._y=a._y),this._z<a._z&&(this._z=a._z),this._onChangeCallback(),this},clamp:function(a,b){return this._x<a._x?this._x=a._x:this._x>b._x&&(this._x=b._x),this._y<a._y?this._y=a._y:this._y>b._y&&(this._y=b._y),this._z<a._z?this._z=a._z:this._z>b._z&&(this._z=b._z),this._onChangeCallback(),this},clampScalar:function(){var a,b;return function(c,d){return void 0===a&&(a=new Zia.Vector3,b=new Zia.Vector3),a.set(c,c,c),b.set(d,d,d),this.clamp(a,b)}}(),floor:function(){return this._x=Math.floor(this._x),this._y=Math.floor(this._y),this._z=Math.floor(this._z),this._onChangeCallback(),this},ceil:function(){return this._x=Math.ceil(this._x),this._y=Math.ceil(this._y),this._z=Math.ceil(this._z),this._onChangeCallback(),this},round:function(){return this._x=Math.round(this._x),this._y=Math.round(this._y),this._z=Math.round(this._z),this._onChangeCallback(),this},roundToZero:function(){return this._x=this._x<0?Math.ceil(this._x):Math.floor(this._x),this._y=this._y<0?Math.ceil(this._y):Math.floor(this._y),this._z=this._z<0?Math.ceil(this._z):Math.floor(this._z),this._onChangeCallback(),this},negate:function(){return this.multiplyScalar(-1)},nearEqual:function(a,b){return Zia.MathUtil.withinEpsilon(this._x,a._x,b._x)&&Zia.MathUtil.withinEpsilon(this._y,a._y,b._y)&&Zia.MathUtil.withinEpsilon(this._z,a._z,b._z)},dot:function(a){return this._x*a._x+this._y*a._y+this._z*a._z},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z)},lengthManhattan:function(){return Math.abs(this._x)+Math.abs(this._y)+Math.abs(this._z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){var b=this.length();return 0!==b&&a!==b&&this.multiplyScalar(a/b),this},lerp:function(a,b){return this._x+=(a._x-this._x)*b,this._y+=(a._y-this._y)*b,this._z+=(a._z-this._z)*b,this._onChangeCallback(),this},cross:function(a){var b=this._x,c=this._y,d=this._z;return this._x=c*a._z-d*a._y,this._y=d*a._x-b*a._z,this._z=b*a._y-c*a._x,this._onChangeCallback(),this},crossVectors:function(a,b){var c=a._x,d=a._y,e=a._z,f=b._x,g=b._y,h=b._z;return this._x=d*h-e*g,this._y=e*f-c*h,this._z=c*g-d*f,this._onChangeCallback(),this},projectOnVector:function(){var a,b;return function(c){return void 0===a&&(a=new Zia.Vector3),a.copy(c).normalize(),b=this.dot(a),this.copy(a).multiplyScalar(b)}}(),projectOnPlane:function(){var a;return function(b){return void 0===a&&(a=new Zia.Vector3),a.copy(this).projectOnVector(b),this.sub(a)}}(),reflect:function(){var a;return function(b){return void 0===a&&(a=new Zia.Vector3),this.sub(a.copy(b).multiplyScalar(2*this.dot(b)))}}(),angleTo:function(a){var b=this.dot(a)/(this.length()*a.length());return Math.acos(Zia.Math.clamp(b,-1,1))},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this._x-a._x,c=this._y-a._y,d=this._z-a._z;return b*b+c*c+d*d},setFromMatrixPosition:function(a){return this._x=a.elements[12],this._y=a.elements[13],this._z=a.elements[14],this._onChangeCallback(),this},setFromMatrixScale:function(a){var b=this.set(a.elements[0],a.elements[1],a.elements[2]).length(),c=this.set(a.elements[4],a.elements[5],a.elements[6]).length(),d=this.set(a.elements[8],a.elements[9],a.elements[10]).length();return this._x=b,this._y=c,this._z=d,this._onChangeCallback(),this},setFromMatrixColumn:function(a,b){var c=4*a,d=b.elements;return this._x=d[c],this._y=d[c+1],this._z=d[c+2],this._onChangeCallback(),this},equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z},fromArray:function(a){return this._x=a[0],this._y=a[1],this._z=a[2],this._onChangeCallback(),this},toArray:function(){return[this._x,this._y,this._z]},onChange:function(a){return this._onChangeCallback=a,this},_onChangeCallback:function(){},suppressChangeCallback:function(a){var b=this._onChangeCallback;this._onChangeCallback=function(){},a(),this._onChangeCallback=b},clone:function(){return new Zia.Vector3(this._x,this._y,this._z)},toJS:function(){return[this._x,this._y,this._z]}},Zia.Color4=function(a,b,c,d){this.r=a,this.g=b,this.b=c,this.a=d},Zia.Color4.prototype={copy:function(a){return this.r=a.r,this.g=a.g,this.b=a.b,this.a=a.a,this},multiplyScalar:function(a){return this.r*=a,this.g*=a,this.b*=a,this},toJS:function(){return[this.r,this.g,this.b,this.a]}},Zia.Euler=function(a,b,c,d){this._x=a||0,this._y=b||0,this._z=c||0,this._order=d||Zia.Euler.DefaultOrder},Zia.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],Zia.Euler.DefaultOrder="XYZ",Zia.Euler.prototype={constructor:Zia.Euler,_x:0,_y:0,_z:0,_order:Zia.Euler.DefaultOrder,get x(){return this._x},set x(a){this._x=a,this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a,this.onChangeCallback()},get z(){return this._z},set z(a){this._z=a,this.onChangeCallback()},get order(){return this._order},set order(a){this._order=a,this.onChangeCallback()},set:function(a,b,c,d){return this._x=a,this._y=b,this._z=c,this._order=d||this._order,this.onChangeCallback(),this},copy:function(a){return this._x=a._x,this._y=a._y,this._z=a._z,this._order=a._order,this.onChangeCallback(),this},setFromRotationMatrix:function(a,b){var c=Zia.Math.clamp,d=a.elements,e=d[0],f=d[4],g=d[8],h=d[1],i=d[5],j=d[9],k=d[2],l=d[6],m=d[10];return b=b||this._order,"XYZ"===b?(this._y=Math.asin(c(g,-1,1)),Math.abs(g)<.99999?(this._x=Math.atan2(-j,m),this._z=Math.atan2(-f,e)):(this._x=Math.atan2(l,i),this._z=0)):"YXZ"===b?(this._x=Math.asin(-c(j,-1,1)),Math.abs(j)<.99999?(this._y=Math.atan2(g,m),this._z=Math.atan2(h,i)):(this._y=Math.atan2(-k,e),this._z=0)):"ZXY"===b?(this._x=Math.asin(c(l,-1,1)),Math.abs(l)<.99999?(this._y=Math.atan2(-k,m),this._z=Math.atan2(-f,i)):(this._y=0,this._z=Math.atan2(h,e))):"ZYX"===b?(this._y=Math.asin(-c(k,-1,1)),Math.abs(k)<.99999?(this._x=Math.atan2(l,m),this._z=Math.atan2(h,e)):(this._x=0,this._z=Math.atan2(-f,i))):"YZX"===b?(this._z=Math.asin(c(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(-j,i),this._y=Math.atan2(-k,e)):(this._x=0,this._y=Math.atan2(g,m))):"XZY"===b?(this._z=Math.asin(-c(f,-1,1)),Math.abs(f)<.99999?(this._x=Math.atan2(l,i),this._y=Math.atan2(g,e)):(this._x=Math.atan2(-j,m),this._y=0)):console.warn("Zia.Euler: .setFromRotationMatrix() given unsupported order: "+b),this._order=b,this.onChangeCallback(),this},setFromQuaternion:function(a,b,c){var d=Zia.Math.clamp,e=a.x*a.x,f=a.y*a.y,g=a.z*a.z,h=a.w*a.w;return b=b||this._order,"XYZ"===b?(this._x=Math.atan2(2*(a.x*a.w-a.y*a.z),h-e-f+g),this._y=Math.asin(d(2*(a.x*a.z+a.y*a.w),-1,1)),this._z=Math.atan2(2*(a.z*a.w-a.x*a.y),h+e-f-g)):"YXZ"===b?(this._x=Math.asin(d(2*(a.x*a.w-a.y*a.z),-1,1)),this._y=Math.atan2(2*(a.x*a.z+a.y*a.w),h-e-f+g),this._z=Math.atan2(2*(a.x*a.y+a.z*a.w),h-e+f-g)):"ZXY"===b?(this._x=Math.asin(d(2*(a.x*a.w+a.y*a.z),-1,1)),this._y=Math.atan2(2*(a.y*a.w-a.z*a.x),h-e-f+g),this._z=Math.atan2(2*(a.z*a.w-a.x*a.y),h-e+f-g)):"ZYX"===b?(this._x=Math.atan2(2*(a.x*a.w+a.z*a.y),h-e-f+g),this._y=Math.asin(d(2*(a.y*a.w-a.x*a.z),-1,1)),this._z=Math.atan2(2*(a.x*a.y+a.z*a.w),h+e-f-g)):"YZX"===b?(this._x=Math.atan2(2*(a.x*a.w-a.z*a.y),h-e+f-g),this._y=Math.atan2(2*(a.y*a.w-a.x*a.z),h+e-f-g),this._z=Math.asin(d(2*(a.x*a.y+a.z*a.w),-1,1))):"XZY"===b?(this._x=Math.atan2(2*(a.x*a.w+a.y*a.z),h-e+f-g),this._y=Math.atan2(2*(a.x*a.z+a.y*a.w),h+e-f-g),this._z=Math.asin(d(2*(a.z*a.w-a.x*a.y),-1,1))):console.warn("Zia.Euler: .setFromQuaternion() given unsupported order: "+b),this._order=b,c!==!1&&this.onChangeCallback(),this},reorder:function(){var a=new Zia.Quaternion;return function(b){a.setFromEuler(this),this.setFromQuaternion(a,b)}}(),equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._order===this._order},fromArray:function(a){return this._x=a[0],this._y=a[1],this._z=a[2],void 0!==a[3]&&(this._order=a[3]),this.onChangeCallback(),this},toArray:function(){return[this._x,this._y,this._z,this._order]},onChange:function(a){return this.onChangeCallback=a,this},onChangeCallback:function(){},clone:function(){return new Zia.Euler(this._x,this._y,this._z,this._order)}},Zia.Math={/*!
  Math.uuid.js (v1.4)
  http://www.broofa.com
  mailto:robert@broofa.com

  Copyright (c) 2010 Robert Kieffer
  Dual licensed under the MIT and GPL licenses.
  */
generateUUID:function(){var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");return function(b,c){var d,e=a,f=[];if(c=c||e.length,b)for(d=0;b>d;d++)f[d]=e[0|Math.random()*c];else{var g;for(f[8]=f[13]=f[18]=f[23]="-",f[14]="4",d=0;36>d;d++)f[d]||(g=0|16*Math.random(),f[d]=e[19==d?3&g|8:g])}return f.join("")}}(),clamp:function(a,b,c){return b>a?b:a>c?c:a},degToRad:function(){var a=Math.PI/180;return function(b){return b*a}}()},Zia.MathUtil={TWO_PI:2*Math.PI,PI_OVER_TWO:Math.PI/2,PI_OVER_FOUR:Math.PI/4,withinEpsilon:function(a,b,c){var d=a-b;return d>=-c&&c>=d}},/*!
 * Original code from three.js project. https://github.com/mrdoob/three.js
 * Original code published with the following license:
 *
 * The MIT License
 * 
 * Copyright &copy; 2010-2014 three.js authors
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
Zia.Matrix3=function(a,b,c,d,e,f,g,h,i){this.elements=new Float32Array(9);var j=this.elements;j[0]=void 0!==a?a:1,j[3]=b||0,j[6]=c||0,j[1]=d||0,j[4]=void 0!==e?e:1,j[7]=f||0,j[2]=g||0,j[5]=h||0,j[8]=void 0!==i?i:1},Zia.Matrix3.prototype={constructor:Zia.Matrix3,set:function(a,b,c,d,e,f,g,h,i){var j=this.elements;return j[0]=a,j[3]=b,j[6]=c,j[1]=d,j[4]=e,j[7]=f,j[2]=g,j[5]=h,j[8]=i,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(a){var b=a.elements;return this.set(b[0],b[3],b[6],b[1],b[4],b[7],b[2],b[5],b[8]),this},applyToVector3Array:function(){var a=new Zia.Vector3;return function(b,c,d){void 0===c&&(c=0),void 0===d&&(d=b.length);for(var e=0,f=c;d>e;e+=3,f+=3)a.x=b[f],a.y=b[f+1],a.z=b[f+2],a.applyMatrix3(this),b[f]=a.x,b[f+1]=a.y,b[f+2]=a.z;return b}}(),multiplyScalar:function(a){var b=this.elements;return b[0]*=a,b[3]*=a,b[6]*=a,b[1]*=a,b[4]*=a,b[7]*=a,b[2]*=a,b[5]*=a,b[8]*=a,this},determinant:function(){var a=this.elements,b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8];return b*f*j-b*g*i-c*e*j+c*g*h+d*e*i-d*f*h},getInverse:function(a,b){var c=a.elements,d=this.elements;d[0]=c[10]*c[5]-c[6]*c[9],d[1]=-c[10]*c[1]+c[2]*c[9],d[2]=c[6]*c[1]-c[2]*c[5],d[3]=-c[10]*c[4]+c[6]*c[8],d[4]=c[10]*c[0]-c[2]*c[8],d[5]=-c[6]*c[0]+c[2]*c[4],d[6]=c[9]*c[4]-c[5]*c[8],d[7]=-c[9]*c[0]+c[1]*c[8],d[8]=c[5]*c[0]-c[1]*c[4];var e=c[0]*d[0]+c[1]*d[3]+c[2]*d[6];if(0===e){var f="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(b)throw new Error(f);return console.warn(f),this.identity(),this}return this.multiplyScalar(1/e),this},transpose:function(){var a,b=this.elements;return a=b[1],b[1]=b[3],b[3]=a,a=b[2],b[2]=b[6],b[6]=a,a=b[5],b[5]=b[7],b[7]=a,this},flattenToArrayOffset:function(a,b){var c=this.elements;return a[b]=c[0],a[b+1]=c[1],a[b+2]=c[2],a[b+3]=c[3],a[b+4]=c[4],a[b+5]=c[5],a[b+6]=c[6],a[b+7]=c[7],a[b+8]=c[8],a},getNormalMatrix:function(a){return this.getInverse(a).transpose(),this},transposeIntoArray:function(a){var b=this.elements;return a[0]=b[0],a[1]=b[3],a[2]=b[6],a[3]=b[1],a[4]=b[4],a[5]=b[7],a[6]=b[2],a[7]=b[5],a[8]=b[8],this},fromArray:function(a){return this.elements.set(a),this},toArray:function(){var a=this.elements;return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8]]},clone:function(){var a=this.elements;return new Zia.Matrix3(a[0],a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8])}},/*!
 * Original code from three.js project. https://github.com/mrdoob/three.js
 * Original code published with the following license:
 *
 * The MIT License
 * 
 * Copyright &copy; 2010-2014 three.js authors
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
Zia.Matrix4=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q;q=void 0===a?[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]:[a,e,i,m,b,f,j,n,c,g,k,o,d,h,l,p],this.elements=new Float32Array(q)},Zia.Matrix4.compose=function(){var a=new Zia.Matrix4;return function(b,c,d,e){return Zia.Matrix4.createFromQuaternion(c,e),e.multiply(Zia.Matrix4.createScale(b,a)),e.setTranslation(d),e}}(),Zia.Matrix4.createTranslation=function(a,b){return b.set(1,0,0,a.x,0,1,0,a.y,0,0,1,a.z,0,0,0,1)},Zia.Matrix4.createRotationX=function(a,b){var c=Math.cos(a),d=Math.sin(a);return b.set(1,0,0,0,0,c,-d,0,0,d,c,0,0,0,0,1)},Zia.Matrix4.createRotationY=function(a,b){var c=Math.cos(a),d=Math.sin(a);return b.set(c,0,d,0,0,1,0,0,-d,0,c,0,0,0,0,1)},Zia.Matrix4.createRotationZ=function(a,b){var c=Math.cos(a),d=Math.sin(a);return b.set(c,-d,0,0,d,c,0,0,0,0,1,0,0,0,0,1)},Zia.Matrix4.createFromAxisAngle=function(a,b,c){var d=Math.cos(b),e=Math.sin(b),f=1-d,g=a.x,h=a.y,i=a.z,j=f*g,k=f*h;return c.set(j*g+d,j*h-e*i,j*i+e*h,0,j*h+e*i,k*h+d,k*i-e*g,0,j*i-e*h,k*i+e*g,f*i*i+d,0,0,0,0,1)},Zia.Matrix4.createFromQuaternion=function(a,b){var c=b.elements,d=a.x,e=a.y,f=a.z,g=a.w,h=d+d,i=e+e,j=f+f,k=d*h,l=d*i,m=d*j,n=e*i,o=e*j,p=f*j,q=g*h,r=g*i,s=g*j;return c[0]=1-(n+p),c[4]=l-s,c[8]=m+r,c[1]=l+s,c[5]=1-(k+p),c[9]=o-q,c[2]=m-r,c[6]=o+q,c[10]=1-(k+n),c[3]=0,c[7]=0,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,b},Zia.Matrix4.createLookAt=function(){var a=new Zia.Vector3,b=new Zia.Vector3,c=new Zia.Vector3;return function(d,e,f,g){var h=g.elements;c.subVectors(d,e).normalize(),a.crossVectors(f,c).normalize(),b.crossVectors(c,a);var i=a.dot(d),j=b.dot(d),k=c.dot(d);return h[0]=a.x,h[4]=a.y,h[8]=a.z,h[12]=-i,h[1]=b.x,h[5]=b.y,h[9]=b.z,h[13]=-j,h[2]=c.x,h[6]=c.y,h[10]=c.z,h[14]=-k,h[3]=0,h[7]=0,h[11]=0,h[15]=1,g}}(),Zia.Matrix4.createOrthographicOffCenter=function(a,b,c,d,e,f,g){var h=g.elements,i=b-a,j=d-c,k=f-e,l=(b+a)/i,m=(d+c)/j,n=(f+e)/k;return h[0]=2/i,h[4]=0,h[8]=0,h[12]=-l,h[1]=0,h[5]=2/j,h[9]=0,h[13]=-m,h[2]=0,h[6]=0,h[10]=-2/k,h[14]=-n,h[3]=0,h[7]=0,h[11]=0,h[15]=1,g},Zia.Matrix4.createPerspectiveOffCenter=function(a,b,c,d,e,f,g){var h=g.elements,i=2*e/(b-a),j=2*e/(d-c),k=(b+a)/(b-a),l=(d+c)/(d-c),m=-(f+e)/(f-e),n=-2*f*e/(f-e);return h[0]=i,h[4]=0,h[8]=k,h[12]=0,h[1]=0,h[5]=j,h[9]=l,h[13]=0,h[2]=0,h[6]=0,h[10]=m,h[14]=n,h[3]=0,h[7]=0,h[11]=-1,h[15]=0,g},Zia.Matrix4.createPerspectiveFieldOfView=function(a,b,c,d,e){var f=c*Math.tan(.5*a),g=-f,h=g*b,i=f*b;return Zia.Matrix4.createPerspectiveOffCenter(h,i,g,f,c,d,e)},Zia.Matrix4.createScale=function(a,b){return b.set(a.x,0,0,0,0,a.y,0,0,0,0,a.z,0,0,0,0,1)},Zia.Matrix4.createUniformScale=function(a,b){return b.set(a,0,0,0,0,a,0,0,0,0,a,0,0,0,0,1)},Zia.Matrix4.createIdentity=function(a){return a.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},Zia.Matrix4.multiply=function(a,b,c){var d=a.elements,e=b.elements,f=c.elements,g=d[0],h=d[4],i=d[8],j=d[12],k=d[1],l=d[5],m=d[9],n=d[13],o=d[2],p=d[6],q=d[10],r=d[14],s=d[3],t=d[7],u=d[11],v=d[15],w=e[0],x=e[4],y=e[8],z=e[12],A=e[1],B=e[5],C=e[9],D=e[13],E=e[2],F=e[6],G=e[10],H=e[14],I=e[3],J=e[7],K=e[11],L=e[15];return f[0]=g*w+h*A+i*E+j*I,f[4]=g*x+h*B+i*F+j*J,f[8]=g*y+h*C+i*G+j*K,f[12]=g*z+h*D+i*H+j*L,f[1]=k*w+l*A+m*E+n*I,f[5]=k*x+l*B+m*F+n*J,f[9]=k*y+l*C+m*G+n*K,f[13]=k*z+l*D+m*H+n*L,f[2]=o*w+p*A+q*E+r*I,f[6]=o*x+p*B+q*F+r*J,f[10]=o*y+p*C+q*G+r*K,f[14]=o*z+p*D+q*H+r*L,f[3]=s*w+t*A+u*E+v*I,f[7]=s*x+t*B+u*F+v*J,f[11]=s*y+t*C+u*G+v*K,f[15]=s*z+t*D+u*H+v*L,c},Zia.Matrix4.multiplyByScalar=function(a,b,c){var d=a.elements,e=c.elements;return e[0]=d[0]*b,e[1]=d[1]*b,e[2]=d[2]*b,e[3]=d[3]*b,e[4]=d[4]*b,e[5]=d[5]*b,e[6]=d[6]*b,e[7]=d[7]*b,e[8]=d[8]*b,e[9]=d[9]*b,e[10]=d[10]*b,e[11]=d[11]*b,e[12]=d[12]*b,e[13]=d[13]*b,e[14]=d[14]*b,e[15]=d[15]*b,c},Zia.Matrix4.invert=function(a,b){var c=a.elements,d=b.elements,e=d[0],f=d[4],g=d[8],h=d[12],i=d[1],j=d[5],k=d[9],l=d[13],m=d[2],n=d[6],o=d[10],p=d[14],q=d[3],r=d[7],s=d[11],t=d[15];c[0]=k*p*r-l*o*r+l*n*s-j*p*s-k*n*t+j*o*t,c[4]=h*o*r-g*p*r-h*n*s+f*p*s+g*n*t-f*o*t,c[8]=g*l*r-h*k*r+h*j*s-f*l*s-g*j*t+f*k*t,c[12]=h*k*n-g*l*n-h*j*o+f*l*o+g*j*p-f*k*p,c[1]=l*o*q-k*p*q-l*m*s+i*p*s+k*m*t-i*o*t,c[5]=g*p*q-h*o*q+h*m*s-e*p*s-g*m*t+e*o*t,c[9]=h*k*q-g*l*q-h*i*s+e*l*s+g*i*t-e*k*t,c[13]=g*l*m-h*k*m+h*i*o-e*l*o-g*i*p+e*k*p,c[2]=j*p*q-l*n*q+l*m*r-i*p*r-j*m*t+i*n*t,c[6]=h*n*q-f*p*q-h*m*r+e*p*r+f*m*t-e*n*t,c[10]=f*l*q-h*j*q+h*i*r-e*l*r-f*i*t+e*j*t,c[14]=h*j*m-f*l*m-h*i*n+e*l*n+f*i*p-e*j*p,c[3]=k*n*q-j*o*q-k*m*r+i*o*r+j*m*s-i*n*s,c[7]=f*o*q-g*n*q+g*m*r-e*o*r-f*m*s+e*n*s,c[11]=g*j*q-f*k*q-g*i*r+e*k*r+f*i*s-e*j*s,c[15]=f*k*m-g*j*m+g*i*n-e*k*n-f*i*o+e*j*o;var u=e*c[0]+i*c[4]+m*c[8]+q*c[12];if(0===u)throw new Error("Can't invert matrix, determinant is 0");return Zia.Matrix4.multiplyByScalar(b,1/u,b),b},Zia.Matrix4.transpose=function(a,b){var c,d=a.elements,e=b.elements;return c=d[1],e[1]=d[4],e[4]=c,c=d[2],e[2]=d[8],e[8]=c,c=d[6],e[6]=d[9],e[9]=c,c=d[3],e[3]=d[12],e[12]=c,c=d[7],e[7]=d[13],e[13]=c,c=d[11],e[11]=d[14],e[14]=c,b},Zia.Matrix4.prototype.constructor=Zia.Matrix4,Zia.Matrix4.prototype.getTranslation=function(a){var b=this.elements;return a.x=b[12],a.y=b[13],a.z=b[14],a},Zia.Matrix4.prototype.setTranslation=function(a){var b=this.elements;b[12]=a.x,b[13]=a.y,b[14]=a.z},Zia.Matrix4.prototype.set=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=this.elements;return q[0]=a,q[4]=b,q[8]=c,q[12]=d,q[1]=e,q[5]=f,q[9]=g,q[13]=h,q[2]=i,q[6]=j,q[10]=k,q[14]=l,q[3]=m,q[7]=n,q[11]=o,q[15]=p,this},Zia.Matrix4.prototype.makeRotationFromEuler=function(a){var b=this.elements,c=a.x,d=a.y,e=a.z,f=Math.cos(c),g=Math.sin(c),h=Math.cos(d),i=Math.sin(d),j=Math.cos(e),k=Math.sin(e);if("XYZ"===a.order){var l=f*j,m=f*k,n=g*j,o=g*k;b[0]=h*j,b[4]=-h*k,b[8]=i,b[1]=m+n*i,b[5]=l-o*i,b[9]=-g*h,b[2]=o-l*i,b[6]=n+m*i,b[10]=f*h}else if("YXZ"===a.order){var p=h*j,q=h*k,r=i*j,s=i*k;b[0]=p+s*g,b[4]=r*g-q,b[8]=f*i,b[1]=f*k,b[5]=f*j,b[9]=-g,b[2]=q*g-r,b[6]=s+p*g,b[10]=f*h}else if("ZXY"===a.order){var p=h*j,q=h*k,r=i*j,s=i*k;b[0]=p-s*g,b[4]=-f*k,b[8]=r+q*g,b[1]=q+r*g,b[5]=f*j,b[9]=s-p*g,b[2]=-f*i,b[6]=g,b[10]=f*h}else if("ZYX"===a.order){var l=f*j,m=f*k,n=g*j,o=g*k;b[0]=h*j,b[4]=n*i-m,b[8]=l*i+o,b[1]=h*k,b[5]=o*i+l,b[9]=m*i-n,b[2]=-i,b[6]=g*h,b[10]=f*h}else if("YZX"===a.order){var t=f*h,u=f*i,v=g*h,w=g*i;b[0]=h*j,b[4]=w-t*k,b[8]=v*k+u,b[1]=k,b[5]=f*j,b[9]=-g*j,b[2]=-i*j,b[6]=u*k+v,b[10]=t-w*k}else if("XZY"===a.order){var t=f*h,u=f*i,v=g*h,w=g*i;b[0]=h*j,b[4]=-k,b[8]=i*j,b[1]=t*k+w,b[5]=f*j,b[9]=u*k-v,b[2]=v*k-u,b[6]=g*j,b[10]=w*k+t}return b[3]=0,b[7]=0,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,this},Zia.Matrix4.prototype.multiply=function(a){return Zia.Matrix4.multiply(this,a,this)},Zia.Matrix4.prototype.determinant=function(){var a=this.elements,b=a[0],c=a[4],d=a[8],e=a[12],f=a[1],g=a[5],h=a[9],i=a[13],j=a[2],k=a[6],l=a[10],m=a[14],n=a[3],o=a[7],p=a[11],q=a[15];return n*(+e*h*k-d*i*k-e*g*l+c*i*l+d*g*m-c*h*m)+o*(+b*h*m-b*i*l+e*f*l-d*f*m+d*i*j-e*h*j)+p*(+b*i*k-b*g*m-e*f*k+c*f*m+e*g*j-c*i*j)+q*(-d*g*j-b*h*k+b*g*l+d*f*k-c*f*l+c*h*j)},Zia.Matrix4.prototype.clone=function(a){return a.elements.set(this.elements),a},Zia.Matrix4.prototype.decompose=function(){var a=new Zia.Vector3,b=new Zia.Matrix4;return function(c,d,e){var f=this.elements,g=a.set(f[0],f[1],f[2]).length(),h=a.set(f[4],f[5],f[6]).length(),i=a.set(f[8],f[9],f[10]).length(),j=this.determinant();0>j&&(g=-g),e.x=f[12],e.y=f[13],e.z=f[14],b.elements.set(this.elements);var k=1/g,l=1/h,m=1/i;return b.elements[0]*=k,b.elements[1]*=k,b.elements[2]*=k,b.elements[4]*=l,b.elements[5]*=l,b.elements[6]*=l,b.elements[8]*=m,b.elements[9]*=m,b.elements[10]*=m,d.setFromRotationMatrix(b),c.x=g,c.y=h,c.z=i,!0}}(),/*!
 * Original code from three.js project. https://github.com/mrdoob/three.js
 * Original code published with the following license:
 *
 * The MIT License
 * 
 * Copyright &copy; 2010-2014 three.js authors
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
Zia.Vector2=function(a,b){this._x=a||0,this._y=b||0},Zia.Vector2.prototype={constructor:Zia.Vector2,get x(){return this._x},set x(a){this._x=a,this._onChangeCallback()},get y(){return this._y},set y(a){this._y=a,this._onChangeCallback()},set:function(a,b){return this._x=a,this._y=b,this._onChangeCallback(),this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;default:throw new Error("index is out of range: "+a)}},getComponent:function(a){switch(a){case 0:return this._x;case 1:return this._y;default:throw new Error("index is out of range: "+a)}},copy:function(a){return this._x=a._x,this._y=a._y,this._onChangeCallback(),this},add:function(a){return this._x+=a._x,this._y+=a._y,this._onChangeCallback(),this},addVectors:function(a,b){return this._x=a._x+b._x,this._y=a._y+b._y,this._onChangeCallback(),this},addScalar:function(a){return this._x+=a,this._y+=a,this._onChangeCallback(),this},sub:function(a){return this._x-=a._x,this._y-=a._y,this._onChangeCallback(),this},subVectors:function(a,b){return this._x=a._x-b._x,this._y=a._y-b._y,this._onChangeCallback(),this},multiply:function(a){return this._x*=a._x,this._y*=a._y,this._onChangeCallback(),this},multiplyScalar:function(a){return this._x*=a,this._y*=a,this._onChangeCallback(),this},divide:function(a){return this._x/=a._x,this._y/=a._y,this._onChangeCallback(),this},divideScalar:function(a){if(0!==a){var b=1/a;this._x*=b,this._y*=b}else this._x=0,this._y=0;return this._onChangeCallback(),this},min:function(a){return this._x>a._x&&(this._x=a._x),this._y>a._y&&(this._y=a._y),this._onChangeCallback(),this},max:function(a){return this._x<a._x&&(this._x=a._x),this._y<a._y&&(this._y=a._y),this._onChangeCallback(),this},clamp:function(a,b){return this._x<a._x?this._x=a._x:this._x>b._x&&(this._x=b._x),this._y<a._y?this._y=a._y:this._y>b._y&&(this._y=b._y),this._onChangeCallback(),this},clampScalar:function(){var a,b;return function(c,d){return void 0===a&&(a=new Zia.Vector2,b=new Zia.Vector2),a.set(c,c),b.set(d,d),this.clamp(a,b)}}(),floor:function(){return this._x=Math.floor(this._x),this._y=Math.floor(this._y),this._onChangeCallback(),this},ceil:function(){return this._x=Math.ceil(this._x),this._y=Math.ceil(this._y),this._onChangeCallback(),this},round:function(){return this._x=Math.round(this._x),this._y=Math.round(this._y),this._onChangeCallback(),this},roundToZero:function(){return this._x=this._x<0?Math.ceil(this._x):Math.floor(this._x),this._y=this._y<0?Math.ceil(this._y):Math.floor(this._y),this._onChangeCallback(),this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this._x*a._x+this._y*a._y},lengthSq:function(){return this._x*this._x+this._y*this._y},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this._x-a._x,c=this._y-a._y;return b*b+c*c},setLength:function(a){var b=this.length();return 0!==b&&a!==b&&this.multiplyScalar(a/b),this},lerp:function(a,b){return this._x+=(a._x-this._x)*b,this._y+=(a._y-this._y)*b,this._onChangeCallback(),this},equals:function(a){return a._x===this._x&&a._y===this._y},fromArray:function(a){return this._x=a[0],this._y=a[1],this._onChangeCallback(),this},toArray:function(){return[this._x,this._y]},onChange:function(a){return this._onChangeCallback=a,this},_onChangeCallback:function(){},clone:function(){return new Zia.Vector2(this._x,this._y)},toJS:function(){return[this._x,this._y]}},/*!
 * Original code from Zia.js project. https://github.com/mrdoob/Zia.js
 * Original code published with the following license:
 *
 * The MIT License
 * 
 * Copyright &copy; 2010-2014 Zia.js authors
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
Zia.Vector4=function(a,b,c,d){this._x=a||0,this._y=b||0,this._z=c||0,this._w=void 0!==d?d:1},Zia.Vector4.prototype={constructor:Zia.Vector4,get x(){return this._x},set x(a){this._x=a,this._onChangeCallback()},get y(){return this._y},set y(a){this._y=a,this._onChangeCallback()},get z(){return this._z},set z(a){this._z=a,this._onChangeCallback()},get w(){return this._w},set w(a){this._w=a,this._onChangeCallback()},set:function(a,b,c,d){return this._x=a,this._y=b,this._z=c,this._w=d,this._onChangeCallback(),this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;case 3:this.w=b;break;default:throw new Error("index is out of range: "+a)}},getComponent:function(a){switch(a){case 0:return this._x;case 1:return this._y;case 2:return this._z;case 3:return this._w;default:throw new Error("index is out of range: "+a)}},copy:function(a){return this._x=a._x,this._y=a._y,this._z=a._z,this._w=void 0!==a._w?a._w:1,this._onChangeCallback(),this},add:function(a){return this._x+=a._x,this._y+=a._y,this._z+=a._z,this._w+=a._w,this._onChangeCallback(),this},addScalar:function(a){return this._x+=a,this._y+=a,this._z+=a,this._w+=a,this._onChangeCallback(),this},addVectors:function(a,b){return this._x=a._x+b._x,this._y=a._y+b._y,this._z=a._z+b._z,this._w=a._w+b._w,this._onChangeCallback(),this},sub:function(a){return this._x-=a._x,this._y-=a._y,this._z-=a._z,this._w-=a._w,this._onChangeCallback(),this},subVectors:function(a,b){return this._x=a._x-b._x,this._y=a._y-b._y,this._z=a._z-b._z,this._w=a._w-b._w,this._onChangeCallback(),this},multiplyScalar:function(a){return this._x*=a,this._y*=a,this._z*=a,this._w*=a,this._onChangeCallback(),this},applyMatrix4:function(a){var b=this._x,c=this._y,d=this._z,e=this._w,f=a.elements;return this._x=f[0]*b+f[4]*c+f[8]*d+f[12]*e,this._y=f[1]*b+f[5]*c+f[9]*d+f[13]*e,this._z=f[2]*b+f[6]*c+f[10]*d+f[14]*e,this._w=f[3]*b+f[7]*c+f[11]*d+f[15]*e,this._onChangeCallback(),this},divideScalar:function(a){if(0!==a){var b=1/a;this._x*=b,this._y*=b,this._z*=b,this._w*=b}else this._x=0,this._y=0,this._z=0,this._w=1;return this._onChangeCallback(),this},setAxisAngleFromQuaternion:function(a){this._w=2*Math.acos(a._w);var b=Math.sqrt(1-a._w*a._w);return 1e-4>b?(this._x=1,this._y=0,this._z=0):(this._x=_q.x/b,this._y=_q.y/b,this._z=_q.z/b),this._onChangeCallback(),this},setAxisAngleFromRotationMatrix:function(a){var b,c,d,e,f=.01,g=.1,h=a.elements,i=h[0],j=h[4],k=h[8],l=h[1],m=h[5],n=h[9],o=h[2],p=h[6],q=h[10];if(Math.abs(j-l)<f&&Math.abs(k-o)<f&&Math.abs(n-p)<f){if(Math.abs(j+l)<g&&Math.abs(k+o)<g&&Math.abs(n+p)<g&&Math.abs(i+m+q-3)<g)return this.set(1,0,0,0),this;b=Math.PI;var r=(i+1)/2,s=(m+1)/2,t=(q+1)/2,u=(j+l)/4,v=(k+o)/4,w=(n+p)/4;return r>s&&r>t?f>r?(c=0,d=.707106781,e=.707106781):(c=Math.sqrt(r),d=u/c,e=v/c):s>t?f>s?(c=.707106781,d=0,e=.707106781):(d=Math.sqrt(s),c=u/d,e=w/d):f>t?(c=.707106781,d=.707106781,e=0):(e=Math.sqrt(t),c=v/e,d=w/e),this.set(c,d,e,b),this}var x=Math.sqrt((p-n)*(p-n)+(k-o)*(k-o)+(l-j)*(l-j));return Math.abs(x)<.001&&(x=1),this._x=(p-n)/x,this._y=(k-o)/x,this._z=(l-j)/x,this._w=Math.acos((i+m+q-1)/2),this._onChangeCallback(),this},min:function(a){return this._x>a._x&&(this._x=a._x),this._y>a._y&&(this._y=a._y),this._z>a._z&&(this._z=a._z),this._w>a._w&&(this._w=a._w),this._onChangeCallback(),this},max:function(a){return this._x<a._x&&(this._x=a._x),this._y<a._y&&(this._y=a._y),this._z<a._z&&(this._z=a._z),this._w<a._w&&(this._w=a._w),this._onChangeCallback(),this},clamp:function(a,b){return this._x<a._x?this._x=a._x:this._x>b._x&&(this._x=b._x),this._y<a._y?this._y=a._y:this._y>b._y&&(this._y=b._y),this._z<a._z?this._z=a._z:this._z>b._z&&(this._z=b._z),this._w<a._w?this._w=a._w:this._w>b._w&&(this._w=b._w),this._onChangeCallback(),this},clampScalar:function(){var a,b;return function(c,d){return void 0===a&&(a=new Zia.Vector4,b=new Zia.Vector4),a.set(c,c,c,c),b.set(d,d,d,d),this.clamp(a,b)}}(),floor:function(){return this._x=Math.floor(this._x),this._y=Math.floor(this._y),this._z=Math.floor(this._z),this._w=Math.floor(this._w),this._onChangeCallback(),this},ceil:function(){return this._x=Math.ceil(this._x),this._y=Math.ceil(this._y),this._z=Math.ceil(this._z),this._w=Math.ceil(this._w),this._onChangeCallback(),this},round:function(){return this._x=Math.round(this._x),this._y=Math.round(this._y),this._z=Math.round(this._z),this._w=Math.round(this._w),this._onChangeCallback(),this},roundToZero:function(){return this._x=this._x<0?Math.ceil(this._x):Math.floor(this._x),this._y=this._y<0?Math.ceil(this._y):Math.floor(this._y),this._z=this._z<0?Math.ceil(this._z):Math.floor(this._z),this._w=this._w<0?Math.ceil(this._w):Math.floor(this._w),this._onChangeCallback(),this},negate:function(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this._w=-this._w,this._onChangeCallback(),this},dot:function(a){return this._x*a._x+this._y*a._y+this._z*a._z+this._w*a._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},lengthManhattan:function(){return Math.abs(this._x)+Math.abs(this._y)+Math.abs(this._z)+Math.abs(this._w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){var b=this.length();return 0!==b&&a!==b&&this.multiplyScalar(a/b),this},lerp:function(a,b){return this._x+=(a._x-this._x)*b,this._y+=(a._y-this._y)*b,this._z+=(a._z-this._z)*b,this._w+=(a._w-this._w)*b,this._onChangeCallback(),this},equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._w===this._w},fromArray:function(a){return this._x=a[0],this._y=a[1],this._z=a[2],this._w=a[3],this._onChangeCallback(),this},toArray:function(){return[this._x,this._y,this._z,this._w]},clone:function(){return new Zia.Vector4(this._x,this._y,this._z,this._w)},onChange:function(a){return this._onChangeCallback=a,this},_onChangeCallback:function(){},suppressChangeCallback:function(a){var b=this._onChangeCallback;this._onChangeCallback=function(){},a(),this._onChangeCallback=b}},Zia.GeometricPrimitive={mergeVertexData:function(){var a=[];if(arguments.length<1)throw"You must pass at least one array in to mergeVertexData";for(var b=arguments[0].length,c=1;c<arguments.length;c++)if(arguments[c].length!==b)throw"All arrays passed in must have the same length";for(var c=0;b>c;c++)for(var d=0;d<arguments.length;d++)Array.prototype.push.apply(a,arguments[d][c].toArray());return a},convertToModel:function(a,b){for(var c=Zia.GeometricPrimitive.mergeVertexData(b.positions,b.normals,b.textureCoordinates),d=new Float32Array(c),e=new Zia.VertexBuffer(a,new Zia.VertexDeclaration([new Zia.VertexElement("aVertexPosition",3,0),new Zia.VertexElement("aVertexNormal",3,12),new Zia.VertexElement("aTextureCoord",2,24)]),d),f=new Zia.IndexBuffer(a,new Uint16Array(b.indices)),g=new Zia.BasicProgram(a),h=new Zia.Model([new Zia.ModelMesh(a,[new Zia.ModelMeshPart({indexBuffer:f,startIndex:0,indexCount:b.indices.length,vertexBuffer:e})])]),i=0;i<h.meshes.length;i++)for(var j=h.meshes[i],k=0;k<j.meshParts.length;k++)j.meshParts[k].program=g;return h}},function(){function a(a,b){function c(a,b){return{location:b,name:a.name,size:a.size,type:a.type}}for(var d={attributes:[],uniforms:[],samplers:{}},e=a.getProgramParameter(b,a.ACTIVE_UNIFORMS),f=a.getProgramParameter(b,a.ACTIVE_ATTRIBUTES),g=0;e>g;g++){var h=a.getActiveUniform(b,g);d.uniforms.push(c(h,a.getUniformLocation(b,h.name)))}for(var g=0;f>g;g++){var i=a.getActiveAttrib(b,g);d.attributes.push(c(i,a.getAttribLocation(b,i.name)))}for(var j=0,g=0;g<d.uniforms.length;g++){var h=d.uniforms[g];switch(h.type){case a.SAMPLER_2D:case a.SAMPLER_CUBE:d.samplers[h.name]=j++}}return d}Zia.Program=function(b,c,d){this._graphicsDevice=b;var e=this._gl=b._gl,f=e.createProgram();e.attachShader(f,c._shader),e.attachShader(f,d._shader),e.linkProgram(f);var g=e.getProgramParameter(f,e.LINK_STATUS);if(!g){var h=e.getProgramInfoLog(f);throw e.deleteProgram(f),new Error("Failed to link program: "+h)}this._program=f;var i=a(this._gl,this._program);this._attributes=i.attributes,this._uniforms=i.uniforms,this._uniformsByName={};for(var j=0;j<this._uniforms.length;j++){var k=this._uniforms[j];this._uniformsByName[k.name]=k}this._samplerIndices=i.samplers}}(),Zia.Program.prototype={apply:function(){this._graphicsDevice._currentProgram=this,this._gl.useProgram(this._program),this._onApply()},_onApply:function(){},setUniform:function(){var a=new Zia.Vector4;return function(b,c){c instanceof Zia.Color4&&(a.set(c.r,c.g,c.b,c.a),c=a);var d=this._uniformsByName[b];if(void 0!==d){var e=this._gl;switch(d.type){case e.FLOAT:e.uniform1f(d.location,c);break;case e.FLOAT_VEC2:e.uniform2f(d.location,c._x,c._y);break;case e.FLOAT_VEC3:e.uniform3f(d.location,c._x,c._y,c._z);break;case e.FLOAT_VEC4:e.uniform4f(d.location,c.x,c.y,c.z,c.w);break;case e.FLOAT_MAT3:e.uniformMatrix3fv(d.location,!1,c.elements);break;case e.FLOAT_MAT4:e.uniformMatrix4fv(d.location,!1,c.elements);break;case e.SAMPLER_2D:this._setUniformSampler(e,d,c,e.TEXTURE_2D);break;case e.SAMPLER_CUBE:this._setUniformSampler(e,d,c,e.TEXTURE_CUBE_MAP);break;default:throw"Not implemented for type: "+d.type}}}}(),_setUniformSampler:function(a,b,c,d){var e=this._samplerIndices[b.name];a.activeTexture(a.TEXTURE0+e),null!==c?(a.bindTexture(d,c._texture),a.uniform1i(b.location,e)):a.bindTexture(d,null)},destroy:function(){for(var a=this._gl.getAttachedShaders(this._program),b=0;b<a.length;b++)this._gl.detachShader(this._program,a[b]);this._gl.deleteProgram(this._program)}},Zia.ProgramDirtyFlags={ModelViewProj:1,Model:2,EyePosition:4,MaterialColor:8,SpecularColor:16,SpecularPower:32,EnvironmentMapAmount:64,EnvironmentMapSpecular:128,FresnelFactor:256,All:-1},Zia.ProgramUtil={enableDefaultLighting:function(a,b,c){return a.direction=new Zia.Vector3(-.5265408,-.5735765,-.6275069),a.diffuseColor=new Zia.Vector3(1,.9607844,.8078432),a.specularColor=new Zia.Vector3(1,.9607844,.8078432),a.enabled=!0,b.direction=new Zia.Vector3(.7198464,.3420201,.6040227),b.diffuseColor=new Zia.Vector3(.9647059,.7607844,.4078432),b.specularColor=new Zia.Vector3,b.enabled=!0,c.direction=new Zia.Vector3(.4545195,-.7660444,.4545195),c.diffuseColor=new Zia.Vector3(.3231373,.3607844,.3937255),c.specularColor=new Zia.Vector3(.3231373,.3607844,.3937255),c.enabled=!0,new Zia.Vector3(.05333332,.09882354,.1819608)},setModelViewProj:function(){var a=new Zia.Matrix4;return function(b,c,d,e,f,g){return 0!=(c&Zia.ProgramDirtyFlags.ModelViewProj)&&(Zia.Matrix4.multiply(e,d,g),Zia.Matrix4.multiply(f,g,a),b.setUniform("uMVPMatrix",a),c&=~Zia.ProgramDirtyFlags.ModelViewProj),c}}(),setMaterialColor:function(a,b,c,d,e,f){if(b){var g=new Zia.Vector4(d.x*c,d.y*c,d.z*c,c),h=new Zia.Vector3((e.x+f.x*d.x)*c,(e.y+f.y*d.y)*c,(e.z+f.z*d.z)*c);a.setUniform("uDiffuseColor",g),a.setUniform("uEmissiveColor",h)}else{var g=new Zia.Vector4((d.x+e.x)*c,(d.y+e.y)*c,(d.z+e.z)*c,c);a.setUniform("uDiffuseColor",g)}},setLightingMatrices:function(){var a=new Zia.Matrix3,b=new Zia.Matrix4,c=new Zia.Vector3;return function(d,e,f,g){return 0!=(e&Zia.ProgramDirtyFlags.Model)&&(d.setUniform("uMMatrix",f),a.getNormalMatrix(f),d.setUniform("uMMatrixInverseTranspose",a),e&=~Zia.ProgramDirtyFlags.Model),0!=(e&Zia.ProgramDirtyFlags.EyePosition)&&(Zia.Matrix4.invert(b,g),c.setFromMatrixColumn(3,b),d.setUniform("uEyePosition",c),e&=~Zia.ProgramDirtyFlags.EyePosition),e}}()},Zia.Comparison={Never:0,Always:1,Less:2,Equal:3,LessEqual:4,Greater:5,GreaterEqual:6,NotEqual:7},Zia.DepthStencilState=function(){this.isDepthEnabled=!0,this.depthFunction=Zia.Comparison.Less},function(){function a(a,b){switch(a){case Zia.Comparison.Never:return b.NEVER;case Zia.Comparison.Always:return b.ALWAYS;case Zia.Comparison.Less:return b.LESS;case Zia.Comparison.Equal:return b.EQUAL;case Zia.Comparison.LessEqual:return b.LEQUAL;case Zia.Comparison.Greater:return b.GREATER;case Zia.Comparison.GreaterEqual:return b.GEQUAL;case Zia.Comparison.NotEqual:return b.NOTEQUAL}}Zia.DepthStencilState.prototype={_apply:function(b){this.isDepthEnabled?(b.enable(b.DEPTH_TEST),b.depthFunc(a(this.depthFunction,b))):b.disable(b.DEPTH_TEST)}}}(),Zia.ClearOptions={DepthBuffer:0,StencilBuffer:1,ColorBuffer:2},Zia.PrimitiveType={PointList:0,LineList:1,LineStrip:2,LineLoop:3,TriangleList:4,TriangleStrip:5,TriangleFan:6},Zia.GraphicsDevice=function(a,b){a.width=a.clientWidth,a.height=a.clientHeight,this._canvas=a;var c=this._gl=a.getContext("webgl",{antialias:!0});b&&(c=this._gl=Zia.DebugUtil.makeDebugContext(c));var d=this._viewport=new Zia.Viewport(0,0,c.drawingBufferWidth,c.drawingBufferHeight);d.onChange(function(){c.viewport(d._x,d._y,d._width,d._height),c.depthRange(d._minDepth,d._maxDepth)}),this.rasterizerState=new Zia.RasterizerState,this.depthStencilState=new Zia.DepthStencilState},Zia.GraphicsDevice.prototype={get viewport(){return this._viewport},get rasterizerState(){return this._rasterizerState},set rasterizerState(a){this._rasterizerState=a,this._rasterizerState._apply(this._gl)},get depthStencilState(){return this._depthStencilState},set depthStencilState(a){this._depthStencilState=a,this._depthStencilState._apply(this._gl)},clear:function(a,b,c,d){var e=0;Zia.EnumUtil.hasFlag(a,Zia.ClearOptions.DepthBuffer)&&(e|=this._gl.DEPTH_BUFFER_BIT,this._gl.clearDepth(c)),Zia.EnumUtil.hasFlag(a,Zia.ClearOptions.StencilBuffer)&&(e|=this._gl.STENCIL_BUFFER_BIT,this._gl.clearStencil(d)),Zia.EnumUtil.hasFlag(a,Zia.ClearOptions.ColorBuffer)&&(e|=this._gl.COLOR_BUFFER_BIT,this._gl.clearColor(b.r,b.g,b.b,b.a)),this._gl.clear(e)},setIndexBuffer:function(a){this._indexBuffer=a},setVertexBuffers:function(a){this._vertexBuffers=a},setVertexBuffer:function(a){this._vertexBuffers=[a]},drawIndexedPrimitives:function(a,b,c){var d=this._gl,e=this._bindVertexAttributes(d);d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,this._indexBuffer._buffer),d.drawElements(this._getMode(a),c,d.UNSIGNED_SHORT,4*b);for(var f=0;f<e.length;f++)d.disableVertexAttribArray(e[f])},drawPrimitives:function(a,b,c){var d=this._gl,e=this._bindVertexAttributes(d);d.drawArrays(this._getMode(a),b,c);for(var f=0;f<e.length;f++)d.disableVertexAttribArray(e[f])},resize:function(){var a=this._canvas,b=a.clientWidth,c=a.clientHeight;return a.width!=b||a.height!=c?(a.width=b,a.height=c,this.viewport.set(0,0,b,c),!0):!1},toggleFullScreen:function(){Zia.HtmlUtil.toggleFullScreen(this._canvas)},_bindVertexAttributes:function(a){for(var b=[],c=0;c<this._currentProgram._attributes.length;c++){var d=this._currentProgram._attributes[c],e=this._findVertexBuffer(d.name);e&&(b.push(d.location),a.bindBuffer(a.ARRAY_BUFFER,e.buffer._buffer),a.vertexAttribPointer(d.location,e.element.numComponents,a.FLOAT,!1,e.buffer._vertexDeclaration.stride,e.element.offset),a.enableVertexAttribArray(d.location))}return b},_findVertexBuffer:function(a){for(var b=0;b<this._vertexBuffers.length;b++)for(var c=this._vertexBuffers[b],d=0;d<c._vertexDeclaration.elements.length;d++){var e=c._vertexDeclaration.elements[d];if(e.attributeName===a)return{buffer:c,element:e}}return null},_getMode:function(a){switch(a){case Zia.PrimitiveType.PointList:return this._gl.POINTS;case Zia.PrimitiveType.LineList:return this._gl.LINES;case Zia.PrimitiveType.LineStrip:return this._gl.LINE_STRIP;case Zia.PrimitiveType.LineLoop:return this._gl.LINE_LOOP;case Zia.PrimitiveType.TriangleList:return this._gl.TRIANGLES;case Zia.PrimitiveType.TriangleStrip:return this._gl.TRIANGLE_STRIP;case Zia.PrimitiveType.TriangleFan:return this._gl.TRIANGLE_FAN}}},Zia.IndexBuffer=function(a,b){this._gl=a._gl,this._buffer=this._gl.createBuffer(),void 0!==b&&this.setData(b)},Zia.IndexBuffer.prototype={setData:function(a){var b=this._gl;b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this._buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,a,b.STATIC_DRAW)},destroy:function(){this._gl.deleteBuffer(this._buffer)}},Zia.Model=function(a){this.meshes=a},Zia.Model.prototype={draw:function(a,b,c,d){d=void 0!==d?d:null;for(var e=0;e<this.meshes.length;e++){for(var f=this.meshes[e],g=0;g<f.programs.length;g++){var h=d||f.programs[g];h.modelMatrix=a,h.viewMatrix=b,h.projectionMatrix=c}f.draw(d)}}},Zia.ModelMesh=function(a,b){this.graphicsDevice=a,this.meshParts=b;for(var c=0;c<b.length;c++)b[c]._parent=this;this.programs=[]},Zia.ModelMesh.prototype={draw:function(a){a=void 0!==a?a:null;for(var b=0;b<this.meshParts.length;b++){var c=this.meshParts[b],d=a||c.program;c.indexCount>0&&(this.graphicsDevice.setVertexBuffer(c.vertexBuffer),this.graphicsDevice.setIndexBuffer(c.indexBuffer),d.apply(),this.graphicsDevice.drawIndexedPrimitives(Zia.PrimitiveType.TriangleList,c.startIndex,c.indexCount))}}},Zia.ModelMeshPart=function(a){a=Zia.ObjectUtil.reverseMerge(a||{},{indexBuffer:null,startIndex:0,indexCount:0,vertexBuffer:null}),this.indexBuffer=a.indexBuffer,this.startIndex=a.startIndex,this.indexCount=a.indexCount,this.vertexBuffer=a.vertexBuffer,this._program=null,this._parent=null},Zia.ModelMeshPart.prototype={get program(){return this._program},set program(a){if(a!==this._program){if(this._program){for(var b=!0,c=0;c<this._parent.meshParts.length;c++){var d=this._parent.meshParts[c];if(d!==this&&d._program===this._program){b=!1;break}}if(b){var e=this._parent.programs.indexOf(this._program);e>=0&&this._parent.programs.splice(e,1)}}this._program=a,this._parent.programs.push(a)}}},Zia.CullMode={Back:0,Front:1,FrontAndBack:2,None:3},Zia.RasterizerState=function(a){a=Zia.ObjectUtil.reverseMerge(a||{},{cullMode:Zia.CullMode.Back,isFrontClockwise:!1,isPolygonOffsetEnabled:!1,polygonOffsetFactor:0,polygonOffsetUnits:0}),this.cullMode=a.cullMode,this.isFrontClockwise=a.isFrontClockwise,this.isPolygonOffsetEnabled=a.isPolygonOffsetEnabled,this.polygonOffsetFactor=a.polygonOffsetFactor,this.polygonOffsetUnits=a.polygonOffsetUnits},Zia.RasterizerState.prototype={_apply:function(a){switch(this.cullMode){case Zia.CullMode.Back:a.enable(a.CULL_FACE),a.cullFace(a.BACK);break;case Zia.CullMode.Front:a.enable(a.CULL_FACE),a.cullFace(a.FRONT);break;case Zia.CullMode.FrontAndBack:a.enable(a.CULL_FACE),a.cullFace(a.FRONT_AND_BACK);break;case Zia.CullMode.None:a.disable(a.CULL_FACE)}a.frontFace(this.isFrontClockwise?a.CW:a.CCW),this.isPolygonOffsetEnabled?(a.enable(a.POLYGON_OFFSET_FILL),a.polygonOffset(this.polygonOffsetFactor,this.polygonOffsetUnits)):a.disable(a.POLYGON_OFFSET_FILL)}},Zia.Shader=function(a,b,c){var d=this._gl=a._gl,e=d.createShader(b);if(d.shaderSource(e,c),d.compileShader(e),!d.getShaderParameter(e,d.COMPILE_STATUS)){var f=d.getShaderInfoLog(e);throw d.deleteShader(e),new Error("Failed to compile shader: "+f)}this._shader=e},Zia.Shader.prototype={destroy:function(){this._gl.deleteShader(this._shader)}},Zia.FragmentShader=function(a,b){Zia.Shader.call(this,a,a._gl.FRAGMENT_SHADER,b)},Zia.FragmentShader.prototype=Object.create(Zia.Shader.prototype),Zia.VertexShader=function(a,b){Zia.Shader.call(this,a,a._gl.VERTEX_SHADER,b)},Zia.VertexShader.prototype=Object.create(Zia.Shader.prototype),Zia.Texture=function(a,b,c){var d=this._gl=a._gl;this._texture=this._gl.createTexture(),this._textureType=c,this._options=Zia.ObjectUtil.reverseMerge(b||{},{filter:Zia.TextureFilter.MinNearestMagMipLinear,wrapS:Zia.TextureWrap.Repeat,wrapT:Zia.TextureWrap.Repeat}),d.bindTexture(c,this._texture),d.texParameteri(c,d.TEXTURE_WRAP_S,Zia.TextureWrap._map(d,this._options.wrapS)),d.texParameteri(c,d.TEXTURE_WRAP_T,Zia.TextureWrap._map(d,this._options.wrapT));var e=Zia.TextureFilter._map(d,this._options.filter);d.texParameteri(c,d.TEXTURE_MIN_FILTER,e[0]),d.texParameteri(c,d.TEXTURE_MAG_FILTER,e[1]),d.bindTexture(c,null)},Zia.Texture.prototype={_setData:function(a,b){var c=this._gl,d=this._textureType;c.activeTexture(c.TEXTURE0),c.bindTexture(d,this._texture),c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,b),a(c),c.bindTexture(d,null)},_generateMipmap:function(){var a=this._gl,b=this._textureType;a.activeTexture(a.TEXTURE0),a.bindTexture(b,this._texture),a.generateMipmap(b),a.bindTexture(b,null)},destroy:function(){this._gl.deleteTexture(this._texture)}},Zia.Texture2D=function(a,b){Zia.Texture.call(this,a,b,a._gl.TEXTURE_2D)},Zia.Texture2D.prototype=Object.create(Zia.Texture.prototype),Zia.Texture2D.prototype.setData=function(a){var b=this.width,c=this.height;this._setData(function(d){d.texImage2D(d.TEXTURE_2D,0,d.RGBA,b,c,0,d.RGBA,d.UNSIGNED_BYTE,a)},!0),this._generateMipmap()},Zia.Texture2D.createFromImagePath=function(a,b,c){var d=new Zia.Texture2D(a,c),e=a._gl;d.width=1,d.height=1,d.setData(new Uint8Array([255,255,255,255]));var f=new Image;return f.onload=function(){d._setData(function(){e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,f)},!0),d._generateMipmap(),d.width=f.naturalWidth,d.height=f.naturalHeight},f.src=b,d},Zia.Texture2D.createFromImageData=function(a,b,c,d,e){var f=new Zia.Texture2D(a,e);f.width=c,f.height=d;a._gl;return f.setData(b),f},Zia.Texture2D.createWhiteTexture=function(a){var b=new Uint8Array([255,255,255,255]);return Zia.Texture2D.createFromImageData(a,b,1,1)},Zia.CubeMapFace={PositiveX:0,NegativeX:1,PositiveY:2,NegativeY:3,PositiveZ:4,NegativeZ:5,_map:function(a,b){switch(b){case Zia.CubeMapFace.NegativeX:return a.TEXTURE_CUBE_MAP_NEGATIVE_X;case Zia.CubeMapFace.NegativeY:return a.TEXTURE_CUBE_MAP_NEGATIVE_Y;case Zia.CubeMapFace.NegativeZ:return a.TEXTURE_CUBE_MAP_NEGATIVE_Z;case Zia.CubeMapFace.PositiveX:return a.TEXTURE_CUBE_MAP_POSITIVE_X;case Zia.CubeMapFace.PositiveY:return a.TEXTURE_CUBE_MAP_POSITIVE_Y;case Zia.CubeMapFace.PositiveZ:return a.TEXTURE_CUBE_MAP_POSITIVE_Z;default:throw"Invalid face: "+b}}},Zia.TextureCube=function(a,b){Zia.Texture.call(this,a,b,a._gl.TEXTURE_CUBE_MAP)},Zia.TextureCube.prototype=Object.create(Zia.Texture.prototype),Zia.TextureCube.prototype.setData=function(a,b){var c=this.size;this._setData(function(d){d.texImage2D(Zia.CubeMapFace._map(d,a),0,d.RGBA,c,c,0,d.RGBA,d.UNSIGNED_BYTE,b)},!1)},Zia.TextureCube.createFromImagePaths=function(a,b,c){if(6!==b.length)throw"Must pass an array of 6 URLs";var d=new Zia.TextureCube(a,c);d.size=1;for(var e=new Uint8Array([255,255,255,255]),f=0;6>f;f++)d.setData(f,e);for(var g=a._gl,h=0,f=0;f<b.length;f++){var i=b[f];!function(a){var b=new Image;b.onload=function(){if(d._setData(function(){g.texImage2D(Zia.CubeMapFace._map(g,a),0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,b)},!1),b.naturalWidth!=b.naturalHeight)throw"Must use square textures for TextureCube";if(0===h)d.size=b.naturalWidth;else if(b.naturalWidth!==d.size)throw"All 6 textures must have the same dimensions";h++,6===h&&d._generateMipmap()},b.src=i}(f)}return d},Zia.TextureFilter={MinMagMipNearest:0,MinMagNearestMipLinear:1,MinNearestMagLinearMipNearest:2,MinNearestMagMipLinear:3,MinLinearMagMipNearest:4,MinLinearMagNearestMipLinear:5,MinMagLinearMipNearest:6,MinMagMipLinear:7,MinMagNearest:8,MinNearestMagLinear:9,MinLinearMagNearest:10,MinMagLinear:11,_map:function(a,b){switch(b){case Zia.TextureFilter.MinMagMipNearest:return[a.NEAREST_MIPMAP_NEAREST,a.NEAREST];case Zia.TextureFilter.MinMagNearestMipLinear:return[a.NEAREST_MIPMAP_LINEAR,a.NEAREST];case Zia.TextureFilter.MinNearestMagLinearMipNearest:return[a.NEAREST_MIPMAP_NEAREST,a.LINEAR];case Zia.TextureFilter.MinNearestMagMipLinear:return[a.NEAREST_MIPMAP_LINEAR,a.LINEAR];case Zia.TextureFilter.MinLinearMagMipNearest:return[a.LINEAR_MIPMAP_NEAREST,a.NEAREST];case Zia.TextureFilter.MinLinearMagNearestMipLinear:return[a.LINEAR_MIPMAP_LINEAR,a.NEAREST];case Zia.TextureFilter.MinMagLinearMipNearest:return[a.LINEAR_MIPMAP_NEAREST,a.LINEAR];case Zia.TextureFilter.MinMagMipLinear:return[a.LINEAR_MIPMAP_LINEAR,a.LINEAR];case Zia.TextureFilter.MinMagNearest:return[a.NEAREST,a.NEAREST];case Zia.TextureFilter.MinNearestMagLinear:return[a.NEAREST,a.LINEAR];case Zia.TextureFilter.MinLinearMagNearest:return[a.LINEAR,a.NEAREST];case Zia.TextureFilter.MinMagLinear:return[a.LINEAR,a.LINEAR];default:throw"Invalid value: "+b}}},Zia.TextureWrap={Repeat:0,ClampToEdge:1,MirroredRepeat:2,_map:function(a,b){switch(b){case Zia.TextureWrap.Repeat:return a.REPEAT;case Zia.TextureWrap.ClampToEdge:return a.CLAMP_TO_EDGE;case Zia.TextureWrap.MirroredRepeat:return a.MIRRORED_REPEAT;default:throw"Invalid value: "+filter}}},Zia.VertexBuffer=function(a,b,c){this._gl=a._gl,this._buffer=this._gl.createBuffer(),this._vertexDeclaration=b,void 0!==c&&this.setData(c)},Zia.VertexBuffer.prototype={setData:function(a){var b=this._gl;b.bindBuffer(b.ARRAY_BUFFER,this._buffer),b.bufferData(b.ARRAY_BUFFER,a,b.STATIC_DRAW)},destroy:function(){this._gl.deleteBuffer(this._buffer)}},Zia.VertexElement=function(a,b,c){this.attributeName=a,this.numComponents=b,this.offset=void 0!==c?c:0},Zia.VertexDeclaration=function(a){this.elements=a,this.stride=4*a.map(function(a){return a.numComponents}).reduce(function(a,b){return a+b},0)},Zia.Viewport=function(a,b,c,d,e,f){this._x=a,this._y=b,this._width=c,this._height=d,this._minDepth=void 0!==e?e:0,this._maxDepth=void 0!==f?f:1},Zia.Viewport.prototype={get x(){return this._x},set x(a){this._x=a,this._onChangeCallback()},get y(){return this._y},set y(a){this._y=a,this._onChangeCallback()},get width(){return this._width},set width(a){this._width=a,this._onChangeCallback()},get height(){return this._height},set height(a){this._height=a,this._onChangeCallback()},get minDepth(){return this._minDepth},set minDepth(a){this._minDepth=a,this._onChangeCallback()},get maxDepth(){return this._maxDepth},set maxDepth(a){this._maxDepth=a,this._onChangeCallback()},get aspectRatio(){return 0==this._height||0==this._width?0:this._width/this._height},set:function(a,b,c,d,e,f){this._x=a,this._y=b,this._width=c,this._height=d,void 0!==e&&(this._minDepth=e),void 0!==f&&(this._maxDepth=f),this._onChangeCallback()},onChange:function(a){return this._onChangeCallback=a,this},_onChangeCallback:function(){},suppressChangeCallback:function(a){var b=this._onChangeCallback;this._onChangeCallback=function(){},a(),this._onChangeCallback=b}},function(){var a=6,b=[new Zia.Vector3(0,0,1),new Zia.Vector3(0,0,-1),new Zia.Vector3(1,0,0),new Zia.Vector3(-1,0,0),new Zia.Vector3(0,1,0),new Zia.Vector3(0,-1,0)],c=[new Zia.Vector2(1,1),new Zia.Vector2(1,0),new Zia.Vector2(0,0),new Zia.Vector2(0,1)],d=new Zia.Vector3,e=new Zia.Vector3;Zia.GeometricPrimitive.createCube=function(f){void 0===f&&(f=1);var g=[],h=[],i=[],j=[];f/=2;for(var k=0;a>k;k++){var l=b[k],m=k>=4?new Zia.Vector3(0,0,1):new Zia.Vector3(0,1,0);d.set(l.x,l.y,l.z),d.cross(m),e.set(l.x,l.y,l.z),e.cross(d);var n=4*k;j.push(n+0),j.push(n+2),j.push(n+1),j.push(n+0),j.push(n+3),j.push(n+2),g.push(l.clone().sub(d).sub(e).multiplyScalar(f)),g.push(l.clone().sub(d).add(e).multiplyScalar(f)),g.push(l.clone().add(d).add(e).multiplyScalar(f)),g.push(l.clone().add(d).sub(e).multiplyScalar(f)),h.push(l),h.push(l),h.push(l),h.push(l),i.push(c[0]),i.push(c[1]),i.push(c[2]),i.push(c[3])}return{positions:g,normals:h,textureCoordinates:i,indices:j}}}(),function(){function a(a,b){var c=2*a*Math.PI/b,d=Math.sin(c),e=Math.cos(c);return new Zia.Vector3(d,0,e)}function b(b,d,e,f,g,h,i,j){for(var k=0;g-2>k;k++){var l=(k+1)%g,m=(k+2)%g;j&&(m=[l,l=m][0]);var n=b.length;f.push(n),f.push(n+m),f.push(n+l)}var o=new Zia.Vector3(0,1,0),p=new Zia.Vector2(-.5,-.5);j||(o.negate(),p.x=-p.x);for(var k=0;g>k;k++){var q=a(k,g),r=q.clone().multiplyScalar(i);c.set(o.x,o.y,o.z),c.multiplyScalar(h),r.add(c),b.push(r),d.push(o),e.push(new Zia.Vector2(q.x*p.x+.5,1-q.z*p.y+.5))}}var c=new Zia.Vector3,d=new Zia.Vector2(0,1);Zia.GeometricPrimitive.createCylinder=function(c,e,f){if(c=void 0!==c?c:1,e=void 0!==e?e:1,f=void 0!==f?f:32,3>f)throw"tessellation must be >= 3";var g=[],h=[],i=[],j=[];c/=2;for(var k=new Zia.Vector3(0,1,0).multiplyScalar(c),l=e/2,m=f+1,n=0;f>=n;n++){var o=a(n,f),p=o.clone().multiplyScalar(l),q=new Zia.Vector2(n/f,1);g.push(p.clone().add(k)),h.push(o),i.push(q),g.push(p.clone().sub(k)),h.push(o),i.push(q.clone().sub(d)),j.push(2*n),j.push(2*n+1),j.push((2*n+2)%(2*m)),j.push(2*n+1),j.push((2*n+3)%(2*m)),j.push((2*n+2)%(2*m))}return b(g,h,i,j,f,c,l,!0),b(g,h,i,j,f,c,l,!1),{positions:g,normals:h,textureCoordinates:i,indices:j}}}(),function(){Zia.GeometricPrimitive.createPlane=function(a,b,c,d){if(a=void 0!==a?a:1,b=void 0!==b?b:1,c=void 0!==c?c:1,d=void 0!==d?d:new Zia.Vector2(1,1),1>c)throw"tessellation must be > 0";var e=c+1,f=new Array(e*e),g=new Array(e*e),h=new Array(e*e),i=new Array(c*c*6),j=a/c,k=b/c;a/=2,b/=2;for(var l=new Zia.Vector3(0,1,0),m=0,n=0;c+1>n;n++)for(var o=0;c+1>o;o++)f[m]=new Zia.Vector3(-a+j*o,0,b-k*n),g[m]=l,h[m]=new Zia.Vector2(1-1*o/c*d.x,1-1*n/c*d.y),m++;for(var p=0,n=0;c>n;n++)for(var o=0;c>o;o++){var q=e*n+o;i[p++]=q+1,i[p++]=q+1+e,i[p++]=q+e,i[p++]=q+1,i[p++]=q+e,i[p++]=q}return{positions:f,normals:g,textureCoordinates:h,indices:i}}}(),function(){Zia.GeometricPrimitive.createSphere=function(a,b){if(a=void 0!==a?a:1,b=void 0!==b?b:16,3>b)throw"tessellation must be >= 3";for(var c=b,d=2*b,e=new Array((c+1)*(d+1)),f=new Array((c+1)*(d+1)),g=new Array((c+1)*(d+1)),h=new Array(c*(d+1)*6),i=a/2,j=0,k=0;c>=k;k++)for(var l=1-k/c,m=k*Math.PI/c-Math.PI/2,n=Math.sin(m),o=Math.cos(m),p=0;d>=p;p++){var q=p/d,r=2*p*Math.PI/d,s=Math.sin(r),t=Math.cos(r);s*=o,t*=o;var u=new Zia.Vector3(s,n,t),v=new Zia.Vector2(q,1-l);e[j]=u.clone().multiplyScalar(i),f[j]=u,g[j]=v,j++}for(var w=d+1,x=0,k=0;c>k;k++)for(var p=0;d>=p;p++){var y=k+1,z=(p+1)%w;h[x++]=k*w+p,h[x++]=k*w+z,h[x++]=y*w+p,h[x++]=k*w+z,h[x++]=y*w+z,h[x++]=y*w+p}return{positions:e,normals:f,textureCoordinates:g,indices:h}}}(),function(){function a(a,b,c){for(var d=a+1,e=new Array(6),f=[],g=0;a>g;g++)for(var h=0;a>h;h++){e[0]=c+g*d+h,e[2]=c+(g+1)*d+h,e[1]=c+(g+1)*d+h+1,e[3]=c+g*d+h,e[5]=c+(g+1)*d+h+1,e[4]=c+g*d+h+1,b&&e.reverse();for(var i=0;i<e.length;i++)f.push(e[i])}return f}function b(a,b,c,d,e){var f=e*e,g=(1-e)*(1-e);return i.set(a.x,a.y,a.z).multiplyScalar((1-e)*g),j.set(b.x,b.y,b.z).multiplyScalar(3*e*g),k.set(c.x,c.y,c.z).multiplyScalar(3*f*(1-e)),l.set(d.x,d.y,d.z).multiplyScalar(e*f),i.clone().add(j).add(k).add(l)}function c(a,b,c,d,e){var f=e*e;return m.set(a.x,a.y,a.z).multiplyScalar(-1+2*e-f),n.set(b.x,b.y,b.z).multiplyScalar(1-4*e+3*f),o.set(c.x,c.y,c.z).multiplyScalar(2*e-3*f),p.set(d.x,d.y,d.z).multiplyScalar(f),m.clone().add(n).add(o).add(p)}function d(a,d,e,f,g,h){for(var i=0;d>=i;i++)for(var j=i/d,k=0;d>=k;k++){var l=k/d,m=b(a[0],a[1],a[2],a[3],j),n=b(a[4],a[5],a[6],a[7],j),o=b(a[8],a[9],a[10],a[11],j),p=b(a[12],a[13],a[14],a[15],j),q=b(m,n,o,p,l),r=b(a[0],a[4],a[8],a[12],l),s=b(a[1],a[5],a[9],a[13],l),t=b(a[2],a[6],a[10],a[14],l),u=b(a[3],a[7],a[11],a[15],l),v=c(m,n,o,p,l),w=c(r,s,t,u,j),x=(new Zia.Vector3).crossVectors(v,w);x.nearEqual(new Zia.Vector3,new Zia.Vector3(1e-7))?(x.x=0,x.y=q.y<0?-1:1,x.z=0):(x.normalize(),e&&x.negate());var y=e?1-j:j,z=new Zia.Vector2(y,1-l);f.push(q),g.push(x),h.push(z)}}function e(b,c,e,f,g,i,j,k){for(var l=new Array(16),m=0;16>m;m++)l[m]=h[g.indices[m]].clone().multiply(j);var n=b.length;Array.prototype.push.apply(f,a(i,k,n)),d(l,i,k,b,c,e)}var f=function(a,b){this.mirrorZ=a,this.indices=b},g=[new f(!0,[102,103,104,105,4,5,6,7,8,9,10,11,12,13,14,15]),new f(!0,[12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27]),new f(!0,[24,25,26,27,29,30,31,32,33,34,35,36,37,38,39,40]),new f(!0,[96,96,96,96,97,98,99,100,101,101,101,101,0,1,2,3]),new f(!0,[0,1,2,3,106,107,108,109,110,111,112,113,114,115,116,117]),new f(!1,[41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56]),new f(!1,[53,54,55,56,57,58,59,60,61,62,63,64,28,65,66,67]),new f(!1,[68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83]),new f(!1,[80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95]),new f(!0,[118,118,118,118,124,122,119,121,123,126,125,120,40,39,38,37])],h=[new Zia.Vector3(0,.345,-.05),new Zia.Vector3(-.028,.345,-.05),new Zia.Vector3(-.05,.345,-.028),new Zia.Vector3(-.05,.345,-0),new Zia.Vector3(0,.3028125,-.334375),new Zia.Vector3(-.18725,.3028125,-.334375),new Zia.Vector3(-.334375,.3028125,-.18725),new Zia.Vector3(-.334375,.3028125,-0),new Zia.Vector3(0,.3028125,-.359375),new Zia.Vector3(-.20125,.3028125,-.359375),new Zia.Vector3(-.359375,.3028125,-.20125),new Zia.Vector3(-.359375,.3028125,-0),new Zia.Vector3(0,.27,-.375),new Zia.Vector3(-.21,.27,-.375),new Zia.Vector3(-.375,.27,-.21),new Zia.Vector3(-.375,.27,-0),new Zia.Vector3(0,.13875,-.4375),new Zia.Vector3(-.245,.13875,-.4375),new Zia.Vector3(-.4375,.13875,-.245),new Zia.Vector3(-.4375,.13875,-0),new Zia.Vector3(0,.007499993,-.5),new Zia.Vector3(-.28,.007499993,-.5),new Zia.Vector3(-.5,.007499993,-.28),new Zia.Vector3(-.5,.007499993,-0),new Zia.Vector3(0,-.105,-.5),new Zia.Vector3(-.28,-.105,-.5),new Zia.Vector3(-.5,-.105,-.28),new Zia.Vector3(-.5,-.105,-0),new Zia.Vector3(0,-.105,.5),new Zia.Vector3(0,-.2175,-.5),new Zia.Vector3(-.28,-.2175,-.5),new Zia.Vector3(-.5,-.2175,-.28),new Zia.Vector3(-.5,-.2175,-0),new Zia.Vector3(0,-.27375,-.375),new Zia.Vector3(-.21,-.27375,-.375),new Zia.Vector3(-.375,-.27375,-.21),new Zia.Vector3(-.375,-.27375,-0),new Zia.Vector3(0,-.2925,-.375),new Zia.Vector3(-.21,-.2925,-.375),new Zia.Vector3(-.375,-.2925,-.21),new Zia.Vector3(-.375,-.2925,-0),new Zia.Vector3(0,.17625,.4),new Zia.Vector3(-.075,.17625,.4),new Zia.Vector3(-.075,.2325,.375),new Zia.Vector3(0,.2325,.375),new Zia.Vector3(0,.17625,.575),new Zia.Vector3(-.075,.17625,.575),new Zia.Vector3(-.075,.2325,.625),new Zia.Vector3(0,.2325,.625),new Zia.Vector3(0,.17625,.675),new Zia.Vector3(-.075,.17625,.675),new Zia.Vector3(-.075,.2325,.75),new Zia.Vector3(0,.2325,.75),new Zia.Vector3(0,.12,.675),new Zia.Vector3(-.075,.12,.675),new Zia.Vector3(-.075,.12,.75),new Zia.Vector3(0,.12,.75),new Zia.Vector3(0,.06375,.675),new Zia.Vector3(-.075,.06375,.675),new Zia.Vector3(-.075,.007499993,.75),new Zia.Vector3(0,.007499993,.75),new Zia.Vector3(0,-.04875001,.625),new Zia.Vector3(-.075,-.04875001,.625),new Zia.Vector3(-.075,-.09562501,.6625),new Zia.Vector3(0,-.09562501,.6625),new Zia.Vector3(-.075,-.105,.5),new Zia.Vector3(-.075,-.18,.475),new Zia.Vector3(0,-.18,.475),new Zia.Vector3(0,.02624997,-.425),new Zia.Vector3(-.165,.02624997,-.425),new Zia.Vector3(-.165,-.18,-.425),new Zia.Vector3(0,-.18,-.425),new Zia.Vector3(0,.02624997,-.65),new Zia.Vector3(-.165,.02624997,-.65),new Zia.Vector3(-.165,-.12375,-.775),new Zia.Vector3(0,-.12375,-.775),new Zia.Vector3(0,.195,-.575),new Zia.Vector3(-.0625,.195,-.575),new Zia.Vector3(-.0625,.17625,-.6),new Zia.Vector3(0,.17625,-.6),new Zia.Vector3(0,.27,-.675),new Zia.Vector3(-.0625,.27,-.675),new Zia.Vector3(-.0625,.27,-.825),new Zia.Vector3(0,.27,-.825),new Zia.Vector3(0,.28875,-.7),new Zia.Vector3(-.0625,.28875,-.7),new Zia.Vector3(-.0625,.2934375,-.88125),new Zia.Vector3(0,.2934375,-.88125),new Zia.Vector3(0,.28875,-.725),new Zia.Vector3(-.0375,.28875,-.725),new Zia.Vector3(-.0375,.298125,-.8625),new Zia.Vector3(0,.298125,-.8625),new Zia.Vector3(0,.27,-.7),new Zia.Vector3(-.0375,.27,-.7),new Zia.Vector3(-.0375,.27,-.8),new Zia.Vector3(0,.27,-.8),new Zia.Vector3(0,.4575,-0),new Zia.Vector3(0,.4575,-.2),new Zia.Vector3(-.1125,.4575,-.2),new Zia.Vector3(-.2,.4575,-.1125),new Zia.Vector3(-.2,.4575,-0),new Zia.Vector3(0,.3825,-0),new Zia.Vector3(0,.27,-.35),new Zia.Vector3(-.196,.27,-.35),new Zia.Vector3(-.35,.27,-.196),new Zia.Vector3(-.35,.27,-0),new Zia.Vector3(0,.3075,-.1),new Zia.Vector3(-.056,.3075,-.1),new Zia.Vector3(-.1,.3075,-.056),new Zia.Vector3(-.1,.3075,-0),new Zia.Vector3(0,.3075,-.325),new Zia.Vector3(-.182,.3075,-.325),new Zia.Vector3(-.325,.3075,-.182),new Zia.Vector3(-.325,.3075,-0),new Zia.Vector3(0,.27,-.325),new Zia.Vector3(-.182,.27,-.325),new Zia.Vector3(-.325,.27,-.182),new Zia.Vector3(-.325,.27,-0),new Zia.Vector3(0,-.33,-0),new Zia.Vector3(-.1995,-.33,-.35625),new Zia.Vector3(0,-.31125,-.375),new Zia.Vector3(0,-.33,-.35625),new Zia.Vector3(-.35625,-.33,-.1995),new Zia.Vector3(-.375,-.31125,-0),new Zia.Vector3(-.35625,-.33,-0),new Zia.Vector3(-.21,-.31125,-.375),new Zia.Vector3(-.375,-.31125,-.21)],i=new Zia.Vector3,j=new Zia.Vector3,k=new Zia.Vector3,l=new Zia.Vector3,m=new Zia.Vector3,n=new Zia.Vector3,o=new Zia.Vector3,p=new Zia.Vector3;
Zia.GeometricPrimitive.createTeapot=function(a,b){if(void 0===a&&(a=1),void 0===b&&(b=8),1>b)throw"tessellation must be > 0";var c=[],d=[],f=[],h=[],i=new Zia.Vector3(a,a,a),j=i.clone();j.x=-j.x;var k=i.clone();k.z=-k.z;for(var l=new Zia.Vector3(-a,a,-a),m=0;m<g.length;m++){var n=g[m];e(c,d,f,h,n,b,i,!1),e(c,d,f,h,n,b,j,!0),n.mirrorZ&&(e(c,d,f,h,n,b,k,!0),e(c,d,f,h,n,b,l,!1))}return{positions:c,normals:d,textureCoordinates:f,indices:h}}}(),function(){Zia.GeometricPrimitive.createTorus=function(a,b,c){if(void 0===a&&(a=1),void 0===b&&(b=.33),void 0===c&&(c=32),3>c)throw"tessellation parameter out of range";for(var d=[],e=[],f=[],g=[],h=c+1,i=Zia.Matrix4.createTranslation(new Zia.Vector3(a/2,0,0),new Zia.Matrix4),j=new Zia.Matrix4,k=0;c>=k;k++){var l=k/c,m=k*Zia.MathUtil.TWO_PI/c-Zia.MathUtil.PI_OVER_TWO;Zia.Matrix4.createRotationY(m,j).multiply(i);for(var n=0;c>=n;n++){var o=1-n/c,p=n*Zia.MathUtil.TWO_PI/c+Math.PI,q=Math.cos(p),r=Math.sin(p),s=new Zia.Vector3(q,r,0),t=s.clone().multiplyScalar(b/2),u=new Zia.Vector2(l,1-o);t.applyMatrix4(j),s.transformDirection(j),d.push(t),e.push(s),f.push(u);var v=(k+1)%h,w=(n+1)%h;g.push(k*h+n),g.push(v*h+n),g.push(k*h+w),g.push(k*h+w),g.push(v*h+n),g.push(v*h+w)}}return{positions:d,normals:e,textureCoordinates:f,indices:g}}}(),function(){function a(a){a.push("uniform vec3 uDirLight0Direction;"),a.push("uniform vec3 uDirLight0DiffuseColor;"),a.push("uniform vec3 uDirLight0SpecularColor;"),a.push("uniform vec3 uDirLight1Direction;"),a.push("uniform vec3 uDirLight1DiffuseColor;"),a.push("uniform vec3 uDirLight1SpecularColor;"),a.push("uniform vec3 uDirLight2Direction;"),a.push("uniform vec3 uDirLight2DiffuseColor;"),a.push("uniform vec3 uDirLight2SpecularColor;"),a.push("uniform vec3 uEyePosition;"),a.push("uniform vec3 uEmissiveColor;"),a.push("uniform vec3 uSpecularColor;"),a.push("uniform float uSpecularPower;"),a.push(Zia.SharedProgramCode.lighting)}function b(b){var c=[];return c.push("precision mediump float;"),c.push("attribute vec3 aVertexPosition;"),b.lightingEnabled&&c.push("attribute vec3 aVertexNormal;"),b.vertexColorEnabled&&c.push("attribute vec4 aVertexColor;"),b.textureEnabled&&c.push("attribute vec2 aTextureCoord;"),c.push("uniform mat4 uMVPMatrix;"),b.lightingEnabled&&(c.push("uniform mat4 uMMatrix;"),c.push("uniform mat3 uMMatrixInverseTranspose;")),c.push("uniform vec4 uDiffuseColor;"),c.push("varying vec4 vDiffuseColor;"),b.lightingEnabled&&(b.perPixelLightingEnabled?(c.push("varying vec3 vPositionWS;"),c.push("varying vec3 vNormalWS;")):(c.push("varying vec3 vSpecularColor;"),a(c),c.push(Zia.SharedProgramCode.lightingVertex))),b.textureEnabled&&c.push("varying vec2 vTextureCoord;"),c.push("void main(void) {"),c.push("  gl_Position = uMVPMatrix * vec4(aVertexPosition, 1.0);"),b.lightingEnabled?b.perPixelLightingEnabled?(c.push("  vDiffuseColor = vec4(1, 1, 1, uDiffuseColor.a);"),c.push("  vPositionWS = (uMMatrix * vec4(aVertexPosition, 1.0)).xyz;"),c.push("  vNormalWS = normalize(uMMatrixInverseTranspose * aVertexNormal);")):c.push("  ComputeCommonVSOutputWithLighting(vec4(aVertexPosition, 1.0), aVertexNormal);"):c.push("  vDiffuseColor = uDiffuseColor;"),b.vertexColorEnabled&&c.push("  vDiffuseColor *= aVertexColor;"),b.textureEnabled&&c.push("  vTextureCoord = aTextureCoord;"),c.push("}"),c.join("\n")}function c(b){var c=[];return c.push("precision mediump float;"),c.push("varying vec4 vDiffuseColor;"),b.textureEnabled&&(c.push("varying vec2 vTextureCoord;"),c.push("uniform sampler2D uSampler;")),b.lightingEnabled&&(b.perPixelLightingEnabled?(c.push("uniform vec4 uDiffuseColor;"),c.push("varying vec3 vPositionWS;"),c.push("varying vec3 vNormalWS;"),a(c)):c.push("varying vec3 vSpecularColor;")),c.push(Zia.SharedProgramCode.common),c.push("void main(void) {"),c.push("  vec4 color = vDiffuseColor;"),b.textureEnabled&&c.push("  color *= texture2D(uSampler, vTextureCoord);"),b.lightingEnabled&&(b.perPixelLightingEnabled?(c.push("  vec3 eyeVector = normalize(uEyePosition - vPositionWS);"),c.push("  vec3 worldNormal = normalize(vNormalWS);"),c.push("  ColorPair lightResult = ComputeLights(eyeVector, worldNormal);"),c.push("  color.rgb *= lightResult.Diffuse;"),c.push("  AddSpecular(color, lightResult.Specular);")):c.push("  AddSpecular(color, vSpecularColor.rgb);")),c.push("  gl_FragColor = color;"),c.push("}"),c.join("\n")}Zia.BasicProgram=function(a,d){this._dirtyFlags=Zia.ProgramDirtyFlags.All,this.modelMatrix=new Zia.Matrix4,this.viewMatrix=new Zia.Matrix4,this.projectionMatrix=new Zia.Matrix4,this._modelView=new Zia.Matrix4,this.diffuseColor=new Zia.Vector3(1,1,1),this.emissiveColor=new Zia.Vector3,this.specularColor=new Zia.Vector3(1,1,1),this.specularPower=16,this.alpha=1,this.texture=null,this.ambientLightColor=new Zia.Vector3,this._directionalLight0=new Zia.DirectionalLight(this,0),this._directionalLight1=new Zia.DirectionalLight(this,1),this._directionalLight2=new Zia.DirectionalLight(this,2),this._directionalLight0.enabled=!0,d=Zia.ObjectUtil.reverseMerge(d||{},{lightingEnabled:!1,perPixelLightingEnabled:!0,textureEnabled:!1,vertexColorEnabled:!1}),this._options=d;var e=new Zia.VertexShader(a,b(d)),f=new Zia.FragmentShader(a,c(d));Zia.Program.call(this,a,e,f)}}(),function(){var a=Zia.ProgramDirtyFlags;Zia.BasicProgram.prototype=Object.create(Zia.Program.prototype,{modelMatrix:{get:function(){return this._modelMatrix},set:function(b){this._modelMatrix=b,this._dirtyFlags|=a.Model|a.ModelViewProj|a.Fog}},viewMatrix:{get:function(){return this._viewMatrix},set:function(b){this._viewMatrix=b,this._dirtyFlags|=a.ModelViewProj|a.EyePosition|a.Fog}},projectionMatrix:{get:function(){return this._projectionMatrix},set:function(b){this._projectionMatrix=b,this._dirtyFlags|=a.ModelViewProj}},diffuseColor:{get:function(){return this._diffuseColor},set:function(b){this._diffuseColor=b,this._dirtyFlags|=a.MaterialColor}},emissiveColor:{get:function(){return this._emissiveColor},set:function(b){this._emissiveColor=b,this._dirtyFlags|=a.MaterialColor}},specularColor:{get:function(){return this._specularColor},set:function(b){this._specularColor=b,this._dirtyFlags|=a.SpecularColor}},specularPower:{get:function(){return this._specularPower},set:function(b){this._specularPower=b,this._dirtyFlags|=a.SpecularPower}},alpha:{get:function(){return this._alpha},set:function(b){this._alpha=b,this._dirtyFlags|=a.MaterialColor}},texture:{get:function(){return this._texture},set:function(b){this._texture=b,this._dirtyFlags|=a.Texture}},ambientLightColor:{get:function(){return this._ambientLightColor},set:function(b){this._ambientLightColor=b,this._dirtyFlags|=a.MaterialColor}},directionalLight0:{get:function(){return this._directionalLight0}},directionalLight1:{get:function(){return this._directionalLight1}},directionalLight2:{get:function(){return this._directionalLight2}}}),Zia.BasicProgram.prototype.enableDefaultLighting=function(){if(!this._options.lightingEnabled)throw"Lighting must be enabled when creating this program.";this.ambientLightColor=Zia.ProgramUtil.enableDefaultLighting(this._directionalLight0,this._directionalLight1,this._directionalLight2)},Zia.BasicProgram.prototype._onApply=function(){new Zia.Matrix4,new Zia.Vector4;return function(){this._dirtyFlags=Zia.ProgramUtil.setModelViewProj(this,this._dirtyFlags,this._modelMatrix,this._viewMatrix,this._projectionMatrix,this._modelView),0!=(this._dirtyFlags&a.MaterialColor)&&(Zia.ProgramUtil.setMaterialColor(this,this._options.lightingEnabled,this._alpha,this._diffuseColor,this._emissiveColor,this._ambientLightColor),this._dirtyFlags&=~a.MaterialColor),0!=(this._dirtyFlags&a.SpecularColor)&&(this.setUniform("uSpecularColor",this._specularColor),this._dirtyFlags&=~a.SpecularColor),0!=(this._dirtyFlags&a.SpecularPower)&&(this.setUniform("uSpecularPower",this._specularPower),this._dirtyFlags&=~a.SpecularPower),this._options.lightingEnabled&&(this._dirtyFlags=Zia.ProgramUtil.setLightingMatrices(this,this._dirtyFlags,this._modelMatrix,this._viewMatrix)),this.setUniform("uSampler",this._texture),this._directionalLight0._apply(),this._directionalLight1._apply(),this._directionalLight2._apply()}}()}(),Zia.DirectionalLight=function(a,b){this._program=a,this._index=b,this.direction=new Zia.Vector3,this.diffuseColor=new Zia.Vector3,this.specularColor=new Zia.Vector3,this.enabled=!1},Zia.DirectionalLight.prototype={get direction(){return this._direction},set direction(a){this._direction=a,this._directionChanged=!0},get diffuseColor(){return this._diffuseColor},set diffuseColor(a){this._diffuseColor=a,this._diffuseColorChanged=!0},get specularColor(){return this._specularColor},set specularColor(a){this._specularColor=a,this._specularColorChanged=!0},get enabled(){return this._enabled},set enabled(a){this._enabled=a,this._enabledChanged=!0},_apply:function(){var a=new Zia.Vector3;return function(){this._directionChanged&&(this._setUniform("Direction",this._direction),this._directionChanged=!1),this._diffuseColorChanged&&this._enabled&&(this._setUniform("DiffuseColor",this._diffuseColor),this._diffuseColorChanged=!1),this._specularColorChanged&&this._enabled&&(this._setUniform("SpecularColor",this._specularColor),this._specularColorChanged=!1),this._enabledChanged&&(this._enabled||(this._setUniform("DiffuseColor",a),this._setUniform("SpecularColor",a)),this._enabledChanged=!1)}}(),_setUniform:function(a,b){this._program.setUniform("uDirLight"+this._index+a,b)}},function(){function a(a){var b=[];return b.push("precision mediump float;"),b.push("attribute vec3 aVertexPosition;"),b.push("attribute vec3 aVertexNormal;"),b.push("attribute vec2 aTextureCoord;"),b.push("uniform mat4 uMVPMatrix;"),b.push("uniform mat4 uMMatrix;"),b.push("uniform mat3 uMMatrixInverseTranspose;"),b.push("uniform vec4 uDiffuseColor;"),b.push("uniform float uEnvironmentMapAmount;"),b.push("uniform float uFresnelFactor;"),b.push("uniform vec3 uDirLight0Direction;"),b.push("uniform vec3 uDirLight0DiffuseColor;"),b.push("#define uDirLight0SpecularColor vec3(0,0,0)"),b.push("uniform vec3 uDirLight1Direction;"),b.push("uniform vec3 uDirLight1DiffuseColor;"),b.push("#define uDirLight1SpecularColor vec3(0,0,0)"),b.push("uniform vec3 uDirLight2Direction;"),b.push("uniform vec3 uDirLight2DiffuseColor;"),b.push("#define uDirLight2SpecularColor vec3(0,0,0)"),b.push("uniform vec3 uEyePosition;"),b.push("uniform vec3 uEmissiveColor;"),b.push("#define uSpecularColor vec3(0,0,0)"),b.push("#define uSpecularPower 0"),b.push(Zia.SharedProgramCode.lighting),b.push("varying vec4 vDiffuseColor;"),b.push("varying vec3 vSpecularColor;"),b.push("varying vec2 vTextureCoord;"),b.push("varying vec3 vEnvCoord;"),b.push("float ComputeFresnelFactor(vec3 eyeVector, vec3 worldNormal) {"),b.push("  float viewAngle = dot(eyeVector, worldNormal);"),b.push("  return pow(max(1.0 - abs(viewAngle), 0.0), uFresnelFactor) * uEnvironmentMapAmount;"),b.push("}"),b.push("void main(void) {"),b.push("  gl_Position = uMVPMatrix * vec4(aVertexPosition, 1.0);"),b.push("  vec4 positionWS = uMMatrix * vec4(aVertexPosition, 1.0);"),b.push("  vec3 eyeVector = normalize(uEyePosition - positionWS.xyz);"),b.push("  vec3 worldNormal = normalize(uMMatrixInverseTranspose * aVertexNormal);"),b.push("  ColorPair lightResult = ComputeLights(eyeVector, worldNormal);"),b.push("  vDiffuseColor = vec4(lightResult.Diffuse, uDiffuseColor.a);"),b.push(a.fresnelEnabled?"  vSpecularColor.rgb = vec3(ComputeFresnelFactor(eyeVector, worldNormal));":"  vSpecularColor.rgb = vec3(uEnvironmentMapAmount);"),b.push("  vTextureCoord = aTextureCoord;"),b.push("  vEnvCoord = reflect(-eyeVector, worldNormal);"),b.push("}"),b.join("\n")}function b(a){var b=[];return b.push("precision mediump float;"),b.push("varying vec4 vDiffuseColor;"),b.push("varying vec3 vSpecularColor;"),b.push("varying vec2 vTextureCoord;"),b.push("uniform sampler2D uSampler;"),b.push("varying vec3 vEnvCoord;"),b.push("uniform samplerCube uEnvironmentMapSampler;"),b.push("uniform vec3 uEnvironmentMapSpecular;"),b.push("void main(void) {"),b.push("  vec4 color = vDiffuseColor;"),b.push("  color *= texture2D(uSampler, vTextureCoord);"),b.push("  vec4 envmap = textureCube(uEnvironmentMapSampler, vEnvCoord) * color.a;"),b.push("  color.rgb = mix(color.rgb, envmap.rgb, vSpecularColor.rgb);"),a.environmentMapSpecularEnabled&&b.push("  color.rgb += uEnvironmentMapSpecular * envmap.a;"),b.push("  gl_FragColor = color;"),b.push("}"),b.join("\n")}Zia.EnvironmentMapProgram=function(c,d){this._dirtyFlags=Zia.ProgramDirtyFlags.All,this.modelMatrix=new Zia.Matrix4,this.viewMatrix=new Zia.Matrix4,this.projectionMatrix=new Zia.Matrix4,this._modelView=new Zia.Matrix4,this.diffuseColor=new Zia.Vector3(1,1,1),this.emissiveColor=new Zia.Vector3,this.alpha=1,this.texture=null,this.ambientLightColor=new Zia.Vector3,this._environmentMap=null,this.environmentMapAmount=1,this.environmentMapSpecular=new Zia.Vector3,this.fresnelFactor=1,this._directionalLight0=new Zia.DirectionalLight(this,0),this._directionalLight1=new Zia.DirectionalLight(this,1),this._directionalLight2=new Zia.DirectionalLight(this,2),this._directionalLight0.enabled=!0,d=Zia.ObjectUtil.reverseMerge(d||{},{environmentMapSpecularEnabled:!1,fresnelEnabled:!0}),this._options=d;var e=new Zia.VertexShader(c,a(d)),f=new Zia.FragmentShader(c,b(d));Zia.Program.call(this,c,e,f)}}(),function(){var a=Zia.ProgramDirtyFlags;Zia.EnvironmentMapProgram.prototype=Object.create(Zia.Program.prototype,{modelMatrix:{get:function(){return this._modelMatrix},set:function(b){this._modelMatrix=b,this._dirtyFlags|=a.Model|a.ModelViewProj|a.Fog}},viewMatrix:{get:function(){return this._viewMatrix},set:function(b){this._viewMatrix=b,this._dirtyFlags|=a.ModelViewProj|a.EyePosition|a.Fog}},projectionMatrix:{get:function(){return this._projectionMatrix},set:function(b){this._projectionMatrix=b,this._dirtyFlags|=a.ModelViewProj}},diffuseColor:{get:function(){return this._diffuseColor},set:function(b){this._diffuseColor=b,this._dirtyFlags|=a.MaterialColor}},emissiveColor:{get:function(){return this._emissiveColor},set:function(b){this._emissiveColor=b,this._dirtyFlags|=a.MaterialColor}},alpha:{get:function(){return this._alpha},set:function(b){this._alpha=b,this._dirtyFlags|=a.MaterialColor}},ambientLightColor:{get:function(){return this._ambientLightColor},set:function(b){this._ambientLightColor=b,this._dirtyFlags|=a.MaterialColor}},directionalLight0:{get:function(){return this._directionalLight0}},directionalLight1:{get:function(){return this._directionalLight1}},directionalLight2:{get:function(){return this._directionalLight2}},texture:{get:function(){return this._texture},set:function(a){this._texture=a}},environmentMap:{get:function(){return this._environmentMap},set:function(a){this._environmentMap=a}},environmentMapAmount:{get:function(){return this._environmentMapAmount},set:function(b){this._environmentMapAmount=b,this._dirtyFlags|=a.EnvironmentMapAmount}},environmentMapSpecular:{get:function(){return this._environmentMapSpecular},set:function(b){this._environmentMapSpecular=b,this._dirtyFlags|=a.EnvironmentMapSpecular}},fresnelFactor:{get:function(){return this._fresnelFactor},set:function(b){this._fresnelFactor=b,this._dirtyFlags|=a.FresnelFactor}}}),Zia.EnvironmentMapProgram.prototype.enableDefaultLighting=function(){this.ambientLightColor=Zia.ProgramUtil.enableDefaultLighting(this._directionalLight0,this._directionalLight1,this._directionalLight2)},Zia.EnvironmentMapProgram.prototype._onApply=function(){new Zia.Matrix4,new Zia.Vector4;return function(){this._dirtyFlags=Zia.ProgramUtil.setModelViewProj(this,this._dirtyFlags,this._modelMatrix,this._viewMatrix,this._projectionMatrix,this._modelView),0!=(this._dirtyFlags&a.MaterialColor)&&(Zia.ProgramUtil.setMaterialColor(this,this._options.lightingEnabled,this._alpha,this._diffuseColor,this._emissiveColor,this._ambientLightColor),this._dirtyFlags&=~a.MaterialColor),this.setUniform("uSampler",this._texture),this.setUniform("uEnvironmentMapSampler",this._environmentMap),0!=(this._dirtyFlags&a.EnvironmentMapAmount)&&(this.setUniform("uEnvironmentMapAmount",this._environmentMapAmount),this._dirtyFlags&=~a.EnvironmentMapAmount),0!=(this._dirtyFlags&a.EnvironmentMapSpecular)&&(this.setUniform("uEnvironmentMapSpecular",this._environmentMapSpecular),this._dirtyFlags&=~a.EnvironmentMapSpecular),0!=(this._dirtyFlags&a.FresnelFactor)&&(this.setUniform("uFresnelFactor",this._fresnelFactor),this._dirtyFlags&=~a.FresnelFactor),this._dirtyFlags=Zia.ProgramUtil.setLightingMatrices(this,this._dirtyFlags,this._modelMatrix,this._viewMatrix),this._directionalLight0._apply(),this._directionalLight1._apply(),this._directionalLight2._apply()}}()}(),Zia.SharedProgramCode={common:["void AddSpecular(inout vec4 color, vec3 specular) {","  color.rgb += specular * color.a;","}"].join("\n"),lighting:["struct ColorPair {","  vec3 Diffuse;","  vec3 Specular;","};","ColorPair ComputeLights(vec3 eyeVector, vec3 worldNormal) {","  mat3 lightDirections;","  mat3 lightDiffuse;","  mat3 lightSpecular;","  mat3 halfVectors;","  for (int i = 0; i < 3; i++) {","    lightDirections[i] = mat3(uDirLight0Direction,     uDirLight1Direction,     uDirLight2Direction)    [i];","    lightDiffuse[i]    = mat3(uDirLight0DiffuseColor,  uDirLight1DiffuseColor,  uDirLight2DiffuseColor) [i];","    lightSpecular[i]   = mat3(uDirLight0SpecularColor, uDirLight1SpecularColor, uDirLight2SpecularColor)[i];","    halfVectors[i] = normalize(eyeVector - lightDirections[i]);","  }","  vec3 dotL = worldNormal * -lightDirections;","  vec3 dotH = worldNormal * halfVectors;","  vec3 zeroL = step(vec3(0.0), dotL);","  vec3 diffuse  = zeroL * dotL;","  vec3 specular = pow(max(dotH, vec3(0.0)) * zeroL, vec3(uSpecularPower));","  ColorPair result;","  result.Diffuse  = (lightDiffuse * diffuse)  * uDiffuseColor.rgb + uEmissiveColor;","  result.Specular = (lightSpecular * specular) * uSpecularColor;","  return result;","}"].join("\n"),lightingVertex:["void ComputeCommonVSOutputWithLighting(vec4 position, vec3 normal) {","  vec4 positionWS = uMMatrix * position;","  vec3 eyeVector = normalize(uEyePosition - positionWS.xyz);","  vec3 worldNormal = normalize(uMMatrixInverseTranspose * normal);","  ColorPair lightResult = ComputeLights(eyeVector, worldNormal);","  vDiffuseColor = vec4(lightResult.Diffuse, uDiffuseColor.a);","  vSpecularColor = lightResult.Specular;","}"].join("\n")},function(){function a(a,b){throw WebGLDebugUtils.glEnumToString(a)+" was caused by call to: "+b}function b(a,b){for(var c=0;c<b.length;++c)if(void 0===b[c])throw"undefined passed to gl."+a+"("+WebGLDebugUtils.glFunctionArgsToString(a,b)+")"}Zia.DebugUtil={makeDebugContext:function(c){return WebGLDebugUtils.makeDebugContext(c,a,b)}}}(),Zia.EnumUtil={hasFlag:function(a,b){return(a&b)===b}},Zia.HtmlUtil={toggleFullScreen:function(a){a=void 0!==a?a:document.documentElement,document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():a.requestFullscreen?a.requestFullscreen():a.msRequestFullscreen?a.msRequestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen&&a.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}},Zia.ObjectUtil={reverseMerge:function(a,b){for(var c in b)!b.hasOwnProperty(c)||c in a||(a[c]=b[c]);return a}};